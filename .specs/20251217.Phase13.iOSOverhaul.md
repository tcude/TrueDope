# Phase 13: iOS App Overhaul

**Created**: December 17, 2024
**Status**: Planning
**Reference**: [20251206.MANIFEST.md](./20251206.MANIFEST.md)

---

## Executive Summary

The existing TrueDope iOS app was built against v1 API endpoints (`ShootingRecord`, `ShootingString`) with a dual-session model. TrueDope v2 introduces a unified `RangeSession` architecture with `DopeEntry`, `ChronoSession`, and `GroupEntry` as children.

**Decision**: Nuke and pave. Keep only the Xcode project configuration (bundle ID, capabilities, entitlements, provisioning). Delete all Swift code and rebuild from scratch to match v2 API and web app feature parity.

**Why nuke instead of refactor?**
- Data models are fundamentally different (v1's parallel systems vs v2's unified session)
- API endpoints have changed significantly (14 controllers, new response formats)
- UI patterns have evolved (web app navigation, session flow)
- Technical debt from organic v1 growth
- Cleaner codebase = easier maintenance

---

## What We're Keeping

From the existing `TrueDope-iOS/` project:

| Keep | Reason |
|------|--------|
| `TrueDope-iOS.xcodeproj` | Project configuration, schemes |
| `Info.plist` | Bundle ID (`io.truedope.TrueDope-iOS`), permissions, capabilities |
| `Assets.xcassets` | App icons (review/update if needed) |
| `Config.plist.template` | Runtime configuration pattern |
| Xcode signing & capabilities | Camera, photo library, location permissions already configured |
| SPM package references | Alamofire, KeychainAccess, SDWebImage, Charts (update versions) |

## What We're Deleting

Everything else:
- All Swift files (~94 files, ~11,400 lines)
- All view models, services, models, views
- The entire `App/`, `Models/`, `ViewModels/`, `Views/`, `Services/`, `Utilities/` structure

---

## Target Architecture

### Design Philosophy

**Native iOS First**: Use SwiftUI with platform-native patterns:
- SF Symbols for iconography
- System colors with semantic naming (`.primary`, `.secondary`, `.accent`)
- Native navigation patterns (NavigationStack, TabView)
- iOS conventions (swipe actions, pull-to-refresh, haptics)
- Respects Dynamic Type, Dark Mode, accessibility

**Not a web port**: While maintaining feature parity with the web app, the iOS app should feel like a first-class iOS citizen, not a React Native wrapper.

### Technology Stack

| Component | Choice | Notes |
|-----------|--------|-------|
| UI Framework | SwiftUI | Modern, declarative, iOS 18 |
| Architecture | MVVM + Combine | Clean separation, reactive updates |
| Networking | Alamofire 5.9+ | Mature, well-tested HTTP client |
| Auth Storage | KeychainAccess | Secure token storage |
| Image Loading | SDWebImageSwiftUI | Async image loading with caching |
| Charts | Swift Charts | Native charting |
| State Management | `@Observable` | iOS 17+ native observation macro |
| Local Storage | SwiftData | For offline cache (future consideration) |
| Minimum iOS | 18.0 | Latest iOS with best SwiftUI APIs |

### Dependency Updates

```swift
// Package.swift or SPM in Xcode
dependencies: [
    .package(url: "https://github.com/Alamofire/Alamofire.git", from: "5.9.0"),
    .package(url: "https://github.com/kishikawakatsumi/KeychainAccess.git", from: "4.2.2"),
    .package(url: "https://github.com/SDWebImage/SDWebImageSwiftUI.git", from: "3.0.0"),
]
```

**Removed**: Third-party Charts library (use native Swift Charts for iOS 16+)

---

## Project Structure

```
TrueDope-iOS/
â”œâ”€â”€ TrueDope-iOS.xcodeproj
â”œâ”€â”€ TrueDope-iOS/
â”‚   â”œâ”€â”€ App/
â”‚   â”‚   â”œâ”€â”€ TrueDope_iOSApp.swift          # App entry point
â”‚   â”‚   â””â”€â”€ AppState.swift                  # Global app state
â”‚   â”‚
â”‚   â”œâ”€â”€ Core/
â”‚   â”‚   â”œâ”€â”€ Network/
â”‚   â”‚   â”‚   â”œâ”€â”€ APIClient.swift             # HTTP client (Alamofire wrapper)
â”‚   â”‚   â”‚   â”œâ”€â”€ APIEndpoints.swift          # Endpoint definitions
â”‚   â”‚   â”‚   â”œâ”€â”€ APIError.swift              # Error types
â”‚   â”‚   â”‚   â””â”€â”€ APIResponse.swift           # Response wrapper types
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.swift           # Login, register, logout
â”‚   â”‚   â”‚   â”œâ”€â”€ TokenManager.swift          # JWT storage & refresh
â”‚   â”‚   â”‚   â””â”€â”€ KeychainService.swift       # Keychain wrapper
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Services/
â”‚   â”‚   â”‚   â”œâ”€â”€ RifleService.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionService.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionService.swift        # Unified RangeSession service
â”‚   â”‚   â”‚   â”œâ”€â”€ LocationService.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ WeatherService.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageService.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsService.swift
â”‚   â”‚   â”‚   â””â”€â”€ UserService.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Utilities/
â”‚   â”‚       â”œâ”€â”€ Config.swift                # Environment configuration
â”‚   â”‚       â”œâ”€â”€ DateFormatters.swift        # ISO8601, display formats
â”‚   â”‚       â”œâ”€â”€ UnitConversions.swift       # MOA/MIL, Imperial/Metric
â”‚   â”‚       â””â”€â”€ Validators.swift            # Input validation
â”‚   â”‚
â”‚   â”œâ”€â”€ Models/
â”‚   â”‚   â”œâ”€â”€ User.swift
â”‚   â”‚   â”œâ”€â”€ UserPreferences.swift
â”‚   â”‚   â”œâ”€â”€ RifleSetup.swift
â”‚   â”‚   â”œâ”€â”€ Ammunition.swift
â”‚   â”‚   â”œâ”€â”€ AmmoLot.swift
â”‚   â”‚   â”œâ”€â”€ RangeSession.swift              # Unified session model
â”‚   â”‚   â”œâ”€â”€ DopeEntry.swift
â”‚   â”‚   â”œâ”€â”€ ChronoSession.swift
â”‚   â”‚   â”œâ”€â”€ VelocityReading.swift
â”‚   â”‚   â”œâ”€â”€ GroupEntry.swift
â”‚   â”‚   â”œâ”€â”€ SavedLocation.swift
â”‚   â”‚   â”œâ”€â”€ SharedLocation.swift
â”‚   â”‚   â”œâ”€â”€ Weather.swift
â”‚   â”‚   â”œâ”€â”€ ImageMetadata.swift
â”‚   â”‚   â””â”€â”€ Analytics/
â”‚   â”‚       â”œâ”€â”€ AnalyticsSummary.swift
â”‚   â”‚       â”œâ”€â”€ DopeChartData.swift
â”‚   â”‚       â”œâ”€â”€ VelocityTrends.swift
â”‚   â”‚       â”œâ”€â”€ AmmoComparison.swift
â”‚   â”‚       â”œâ”€â”€ LotComparison.swift
â”‚   â”‚       â””â”€â”€ CostSummary.swift
â”‚   â”‚
â”‚   â”œâ”€â”€ Features/
â”‚   â”‚   â”œâ”€â”€ Auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ LoginViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterView.swift
â”‚   â”‚   â”‚   â””â”€â”€ RegisterViewModel.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ DashboardView.swift         # Home/overview
â”‚   â”‚   â”‚   â””â”€â”€ DashboardViewModel.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Sessions/
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionsListView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionsListViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionDetailView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionDetailViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionCreateView.swift     # Unified session creation
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionCreateViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SessionEditView.swift
â”‚   â”‚   â”‚   â””â”€â”€ Components/
â”‚   â”‚   â”‚       â”œâ”€â”€ SessionCard.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ DopeEntryForm.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ DopeEntryRow.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ ChronoSessionForm.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ VelocityReadingRow.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ GroupEntryForm.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ GroupEntryRow.swift
â”‚   â”‚   â”‚       â”œâ”€â”€ ConditionsSection.swift
â”‚   â”‚   â”‚       â””â”€â”€ LocationPicker.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Rifles/
â”‚   â”‚   â”‚   â”œâ”€â”€ RiflesListView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RiflesListViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RifleDetailView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RifleDetailViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RifleFormView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ RifleFormViewModel.swift
â”‚   â”‚   â”‚   â””â”€â”€ Components/
â”‚   â”‚   â”‚       â””â”€â”€ RifleCard.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Ammunition/
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionListView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionListViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionDetailView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionDetailViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionFormView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmunitionFormViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ LotFormView.swift
â”‚   â”‚   â”‚   â””â”€â”€ Components/
â”‚   â”‚   â”‚       â”œâ”€â”€ AmmoCard.swift
â”‚   â”‚   â”‚       â””â”€â”€ LotRow.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Analytics/
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsView.swift         # Dashboard with summary
â”‚   â”‚   â”‚   â”œâ”€â”€ AnalyticsViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ DopeChartView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ DopeChartViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ VelocityTrendsView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ AmmoComparisonView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ LotComparisonView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ CostAnalysisView.swift
â”‚   â”‚   â”‚   â””â”€â”€ Components/
â”‚   â”‚   â”‚       â”œâ”€â”€ SummaryCard.swift
â”‚   â”‚   â”‚       â””â”€â”€ ChartComponents.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ Settings/
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ SettingsViewModel.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ ProfileView.swift
â”‚   â”‚   â”‚   â”œâ”€â”€ PreferencesView.swift       # Units, display preferences
â”‚   â”‚   â”‚   â”œâ”€â”€ LocationsListView.swift     # Saved locations management
â”‚   â”‚   â”‚   â”œâ”€â”€ LocationFormView.swift
â”‚   â”‚   â”‚   â””â”€â”€ AboutView.swift
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Common/
â”‚   â”‚       â”œâ”€â”€ MainTabView.swift           # Root tab navigation
â”‚   â”‚       â””â”€â”€ Components/                 # Shared UI components
â”‚   â”‚           â”œâ”€â”€ LoadingView.swift
â”‚   â”‚           â”œâ”€â”€ ErrorView.swift
â”‚   â”‚           â”œâ”€â”€ EmptyStateView.swift
â”‚   â”‚           â”œâ”€â”€ SearchBar.swift
â”‚   â”‚           â”œâ”€â”€ FilterSheet.swift
â”‚   â”‚           â”œâ”€â”€ ImageGallery.swift
â”‚   â”‚           â”œâ”€â”€ ImagePicker.swift
â”‚   â”‚           â”œâ”€â”€ ConditionsBadge.swift
â”‚   â”‚           â”œâ”€â”€ StatCard.swift
â”‚   â”‚           â””â”€â”€ FormFields/
â”‚   â”‚               â”œâ”€â”€ ValidatedTextField.swift
â”‚   â”‚               â”œâ”€â”€ NumberField.swift
â”‚   â”‚               â”œâ”€â”€ DatePickerField.swift
â”‚   â”‚               â””â”€â”€ SelectField.swift
â”‚   â”‚
â”‚   â””â”€â”€ Resources/
â”‚       â”œâ”€â”€ Assets.xcassets
â”‚       â”œâ”€â”€ Config.plist
â”‚       â””â”€â”€ Localizable.strings             # Future: localization
â”‚
â””â”€â”€ TrueDope-iOSTests/
    â”œâ”€â”€ Core/
    â”‚   â”œâ”€â”€ AuthServiceTests.swift
    â”‚   â”œâ”€â”€ TokenManagerTests.swift
    â”‚   â””â”€â”€ APIClientTests.swift
    â”œâ”€â”€ Services/
    â”‚   â”œâ”€â”€ RifleServiceTests.swift
    â”‚   â”œâ”€â”€ SessionServiceTests.swift
    â”‚   â””â”€â”€ AmmunitionServiceTests.swift
    â”œâ”€â”€ ViewModels/
    â”‚   â”œâ”€â”€ LoginViewModelTests.swift
    â”‚   â”œâ”€â”€ SessionsListViewModelTests.swift
    â”‚   â””â”€â”€ RiflesListViewModelTests.swift
    â””â”€â”€ Mocks/
        â”œâ”€â”€ MockAPIClient.swift
        â”œâ”€â”€ MockAuthService.swift
        â””â”€â”€ TestData.swift
```

---

## Navigation Structure

### Tab Bar (4 Tabs)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚                    [Content Area]                       â”‚
â”‚                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ  Home  â”‚  ğŸ“‹ Sessions  â”‚  ğŸ”« Rifles  â”‚  âš™ï¸ Settings  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Tab | Icon | Content |
|-----|------|---------|
| **Home** | `house.fill` | Dashboard with recent sessions, quick actions, summary stats |
| **Sessions** | `list.bullet.clipboard` | Session list, create, filter, detail |
| **Rifles** | `scope` | Rifle list, create, detail, ammunition management |
| **Settings** | `gearshape.fill` | Profile, preferences, locations, about |

**Why 4 tabs instead of 5?**
- Mobile real estate is limited
- Ammunition is rifle-adjacent (accessed from rifle detail or session creation)
- Locations are infrequently accessed (settings is appropriate)
- Analytics accessible from Home dashboard

**Navigation Flows:**

```
Home
â”œâ”€â”€ Recent Sessions â†’ Session Detail
â”œâ”€â”€ Quick Actions
â”‚   â”œâ”€â”€ New Session â†’ Session Create
â”‚   â””â”€â”€ View Analytics â†’ Analytics Views
â””â”€â”€ Summary Cards â†’ Detailed Analytics

Sessions
â”œâ”€â”€ Session List (filterable, searchable)
â”‚   â””â”€â”€ Session Detail
â”‚       â”œâ”€â”€ Edit â†’ Session Edit
â”‚       â””â”€â”€ Delete (confirmation)
â””â”€â”€ + New Session â†’ Session Create
    â”œâ”€â”€ Step 1: Date, Rifle, Location
    â”œâ”€â”€ Step 2: Conditions (manual or auto-fetch)
    â””â”€â”€ Step 3: Data Entry (DOPE/Chrono/Groups)

Rifles
â”œâ”€â”€ Rifle List (searchable)
â”‚   â””â”€â”€ Rifle Detail
â”‚       â”œâ”€â”€ Edit â†’ Rifle Form
â”‚       â”œâ”€â”€ Delete (confirmation)
â”‚       â”œâ”€â”€ View Sessions â†’ Filtered Session List
â”‚       â””â”€â”€ Ammunition Section
â”‚           â”œâ”€â”€ View All Ammo â†’ Ammunition List
â”‚           â””â”€â”€ Ammo Detail â†’ Lot Management
â””â”€â”€ + New Rifle â†’ Rifle Form

Settings
â”œâ”€â”€ Profile (name, email)
â”œâ”€â”€ Preferences
â”‚   â”œâ”€â”€ Distance Units (yards/meters)
â”‚   â”œâ”€â”€ Adjustment Units (MOA/MIL)
â”‚   â”œâ”€â”€ Temperature (Â°F/Â°C)
â”‚   â”œâ”€â”€ Pressure (inHg/hPa)
â”‚   â””â”€â”€ Velocity (fps/m/s)
â”œâ”€â”€ Locations
â”‚   â”œâ”€â”€ My Locations (list)
â”‚   â”‚   â”œâ”€â”€ Location Detail
â”‚   â”‚   â””â”€â”€ + New Location
â”‚   â””â”€â”€ Shared Locations (browse/copy)
â”œâ”€â”€ About
â”‚   â”œâ”€â”€ Version info
â”‚   â””â”€â”€ Support links
â””â”€â”€ Logout
```

---

## Data Models

All models match the v2 backend API exactly. Key differences from v1:

### RangeSession (replaces ShootingRecord + ShootingString)

```swift
struct RangeSession: Codable, Identifiable {
    let id: Int
    let userId: String
    let sessionDate: String          // "YYYY-MM-DD" (DateOnly)
    let sessionTime: String?         // "HH:mm:ss" (TimeOnly)

    // Rifle
    let rifleSetupId: Int
    let rifleSetup: RifleSummary?    // Included in list/detail responses

    // Location (either saved or manual)
    let savedLocationId: Int?
    let savedLocation: LocationSummary?
    let latitude: Decimal?
    let longitude: Decimal?
    let locationName: String?

    // Conditions
    let temperature: Decimal?        // Â°F
    let humidity: Decimal?           // %
    let windSpeed: Decimal?          // mph
    let windDirection: String?       // "N", "NE", etc.
    let pressure: Decimal?           // inHg
    let densityAltitude: Int?        // feet

    // Notes
    let notes: String?

    // Child data (present based on session content)
    let dopeEntries: [DopeEntry]?
    let chronoSession: ChronoSession?
    let groupEntries: [GroupEntry]?
    let images: [ImageMetadata]?

    // Computed
    var hasDopeData: Bool { !(dopeEntries?.isEmpty ?? true) }
    var hasChronoData: Bool { chronoSession != nil }
    var hasGroupData: Bool { !(groupEntries?.isEmpty ?? true) }

    let createdAt: Date
    let updatedAt: Date
}
```

### DopeEntry (replaces DistanceHold)

```swift
struct DopeEntry: Codable, Identifiable {
    let id: Int
    let rangeSessionId: Int
    let distance: Int                // yards
    let elevationMils: Decimal
    let windageMils: Decimal
    let ammunitionId: Int?
    let ammoLotId: Int?

    // Computed by backend
    let elevationMOA: Decimal?
    let windageMOA: Decimal?
    let elevationInches: Decimal?
    let windageInches: Decimal?
}
```

### ChronoSession (replaces ShootingString velocity tracking)

```swift
struct ChronoSession: Codable, Identifiable {
    let id: Int
    let rangeSessionId: Int
    let ammunitionId: Int
    let ammoLotId: Int?
    let barrelTemperature: Int?

    let velocityReadings: [VelocityReading]?

    // Computed by backend
    let averageVelocity: Decimal?
    let highVelocity: Decimal?
    let lowVelocity: Decimal?
    let standardDeviation: Decimal?
    let extremeSpread: Decimal?
}

struct VelocityReading: Codable, Identifiable {
    let id: Int
    let chronoSessionId: Int
    let shotNumber: Int
    let velocity: Decimal            // fps
}
```

### GroupEntry (replaces GroupData)

```swift
struct GroupEntry: Codable, Identifiable {
    let id: Int
    let rangeSessionId: Int
    let groupNumber: Int
    let distance: Int                // yards
    let numberOfShots: Int
    let groupSizeMOA: Decimal?
    let meanRadiusMOA: Decimal?
    let ammunitionId: Int?
    let ammoLotId: Int?

    // Computed by backend
    let groupSizeInches: Decimal?

    let images: [ImageMetadata]?
}
```

### Other Models

See [02-data-models.md](../../.specs/02-data-models.md) for complete model definitions. All iOS models will match backend DTOs exactly.

---

## API Integration

### Endpoints (Complete List)

| Category | Endpoint | Method | iOS Usage |
|----------|----------|--------|-----------|
| **Auth** | `/api/auth/login` | POST | Login |
| | `/api/auth/register` | POST | Register |
| | `/api/auth/refresh` | POST | Token refresh |
| | `/api/auth/logout` | POST | Logout |
| **Users** | `/api/users/me` | GET | Get profile |
| | `/api/users/me` | PUT | Update profile |
| | `/api/users/me/password` | PUT | Change password |
| | `/api/users/me/preferences` | GET | Get preferences |
| | `/api/users/me/preferences` | PUT | Update preferences |
| **Rifles** | `/api/rifles` | GET | List rifles |
| | `/api/rifles/{id}` | GET | Rifle detail |
| | `/api/rifles` | POST | Create rifle |
| | `/api/rifles/{id}` | PUT | Update rifle |
| | `/api/rifles/{id}` | DELETE | Delete rifle |
| | `/api/rifles/{id}/has-sessions` | GET | Check before delete |
| **Ammunition** | `/api/ammunition` | GET | List ammo |
| | `/api/ammunition/{id}` | GET | Ammo detail |
| | `/api/ammunition` | POST | Create ammo |
| | `/api/ammunition/{id}` | PUT | Update ammo |
| | `/api/ammunition/{id}` | DELETE | Delete ammo |
| | `/api/ammunition/{id}/lots` | GET | List lots |
| | `/api/ammunition/{id}/lots` | POST | Create lot |
| | `/api/ammunition/{id}/lots/{lotId}` | PUT | Update lot |
| | `/api/ammunition/{id}/lots/{lotId}` | DELETE | Delete lot |
| **Sessions** | `/api/sessions` | GET | List sessions |
| | `/api/sessions/{id}` | GET | Session detail |
| | `/api/sessions` | POST | Create session |
| | `/api/sessions/{id}` | PUT | Update session |
| | `/api/sessions/{id}` | DELETE | Delete session |
| | `/api/sessions/{id}/dope` | POST | Add DOPE entry |
| | `/api/sessions/dope/{id}` | PUT | Update DOPE |
| | `/api/sessions/dope/{id}` | DELETE | Delete DOPE |
| | `/api/sessions/{id}/chrono` | POST | Add chrono session |
| | `/api/sessions/chrono/{id}` | PUT | Update chrono |
| | `/api/sessions/chrono/{id}` | DELETE | Delete chrono |
| | `/api/sessions/chrono/{id}/readings` | POST | Add velocity reading |
| | `/api/sessions/readings/{id}` | DELETE | Delete reading |
| | `/api/sessions/{id}/groups` | POST | Add group entry |
| | `/api/sessions/groups/{id}` | PUT | Update group |
| | `/api/sessions/groups/{id}` | DELETE | Delete group |
| **Locations** | `/api/locations` | GET | List saved locations |
| | `/api/locations/{id}` | GET | Location detail |
| | `/api/locations` | POST | Create location |
| | `/api/locations/{id}` | PUT | Update location |
| | `/api/locations/{id}` | DELETE | Delete location |
| | `/api/shared-locations` | GET | List shared locations |
| | `/api/shared-locations/{id}/copy` | POST | Copy to saved |
| **Weather** | `/api/weather` | GET | Get weather by coords |
| **Geocoding** | `/api/geocoding/search` | GET | Search locations |
| | `/api/geocoding/reverse` | GET | Reverse geocode |
| | `/api/geocoding/elevation` | GET | Get elevation |
| **Images** | `/api/images/{id}` | GET | Get image |
| | `/api/images/{id}/thumbnail` | GET | Get thumbnail |
| | `/api/images/rifle/{id}` | POST | Upload rifle image |
| | `/api/images/session/{id}` | POST | Upload session image |
| | `/api/images/group/{id}` | POST | Upload group image |
| | `/api/images/{id}` | DELETE | Delete image |
| **Analytics** | `/api/analytics/summary` | GET | Dashboard summary |
| | `/api/analytics/dope-chart` | GET | DOPE chart data |
| | `/api/analytics/velocity-trends` | GET | Velocity trends |
| | `/api/analytics/ammo-comparison` | GET | Compare ammo |
| | `/api/analytics/lot-comparison` | GET | Compare lots |
| | `/api/analytics/cost-summary` | GET | Cost analysis |

### API Response Format

```swift
// Standard response wrapper
struct APIResponse<T: Decodable>: Decodable {
    let success: Bool
    let data: T?
    let message: String?
    let error: APIErrorDetail?
}

struct APIErrorDetail: Decodable {
    let code: String
    let description: String
    let validationErrors: [String: [String]]?
}

// Paginated response
struct PaginatedResponse<T: Decodable>: Decodable {
    let success: Bool
    let items: [T]
    let pagination: PaginationInfo
}

struct PaginationInfo: Decodable {
    let currentPage: Int
    let pageSize: Int
    let totalItems: Int
    let totalPages: Int
}
```

### Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    App Launch                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Check Keychain for Tokens                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                         â”‚
            â–¼                         â–¼
    [Tokens Exist]            [No Tokens]
            â”‚                         â”‚
            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validate/Refresh â”‚      â”‚   Show Login      â”‚
â”‚   Access Token    â”‚      â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
    â”‚               â”‚                 â”‚
    â–¼               â–¼                 â”‚
[Valid]        [Invalid]              â”‚
    â”‚               â”‚                 â”‚
    â–¼               â–¼                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚Show App â”‚   â”‚Try Refresh  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   Token     â”‚         â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                    â”‚                 â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”         â”‚
            â”‚               â”‚         â”‚
            â–¼               â–¼         â”‚
        [Success]      [Failure]â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
      [Show App]
```

**Token Storage:**
- Access token: Keychain (`io.truedope.accessToken`)
- Refresh token: Keychain (`io.truedope.refreshToken`)
- Token expiry: UserDefaults (for quick expiry check without decoding)

**Auto-Refresh Logic:**
- Check token expiry before each request
- If expired (or within 60 seconds), refresh first
- If 401 response, attempt refresh and retry once
- If refresh fails, logout and show login

---

## Features & Screens

### 1. Authentication

#### Login Screen
- Email and password fields
- "Remember me" option (store email only)
- "Forgot password" link (opens web forgot-password flow)
- Register link
- Loading state during login
- Error display (inline, not alert)
- Biometric login option (Face ID/Touch ID) - stores refresh token securely

#### Register Screen
- Email, password, confirm password
- First name, last name (optional)
- Password requirements display
- Terms acceptance checkbox
- Loading state, error display

### 2. Home Dashboard

- **Recent Sessions** (last 5, horizontal scroll or list)
  - Tap to view detail
- **Quick Actions**
  - "New Session" button (prominent)
  - "View Analytics" link
- **Summary Stats**
  - Total sessions count
  - Total rounds fired
  - Rifles count
  - Last session date
- Pull-to-refresh

### 3. Sessions

#### Session List
- Search bar (search notes, location name)
- Filter options (sheet):
  - Date range
  - Rifle selection
  - Has DOPE / Has Chrono / Has Groups
- Sort options (date newest/oldest)
- Infinite scroll pagination
- Swipe to delete (with confirmation)
- Session cards showing:
  - Date
  - Rifle name
  - Location (if set)
  - Data type badges (DOPE, Chrono, Groups)
  - Conditions summary (temp, wind)

#### Session Detail
- Header: Date, rifle, location
- Conditions section (collapsible)
- **DOPE Data** (if present)
  - Table: Distance | Elevation | Windage
  - Display in user's preferred units (MOA or MIL)
- **Chrono Data** (if present)
  - Stats: Avg, High, Low, SD, ES
  - Shot-by-shot list (expandable)
  - Ammo/lot info
- **Group Data** (if present)
  - Cards per group: Size MOA, Mean Radius, shot count
  - Images (if attached)
- **Images** section (gallery)
- **Notes** section
- Edit button (toolbar)
- Delete button (toolbar, requires confirmation)

#### Session Create (Multi-step)

**Step 1: Basic Info**
- Date picker (default today)
- Time picker (optional)
- Rifle selector (required)
- Location:
  - "My Locations" picker
  - "Use Current Location" button (GPS)
  - "Browse Shared Locations" link

**Step 2: Conditions**
- "Fetch Weather" button (if location set)
- Manual entry fields:
  - Temperature (Â°F or Â°C per prefs)
  - Humidity (%)
  - Wind speed (mph)
  - Wind direction (picker: N, NE, E, SE, S, SW, W, NW)
  - Pressure (inHg or hPa per prefs)
- Density altitude (display only, calculated)

**Step 3: Data Recording**
- Checkboxes: "Record DOPE", "Record Chrono", "Record Groups"
- Sections appear based on selection:

**DOPE Section:**
- Add distance hold rows
- Distance (yards/meters), Elevation, Windage
- Ammo/lot selector (optional per entry)

**Chrono Section:**
- Ammo selector (required)
- Lot selector (optional)
- Barrel temp (optional)
- Add velocity readings (shot number auto-increments)
- Live stats display as shots added

**Groups Section:**
- Add group entries
- Distance, shot count, group size MOA, mean radius MOA
- Ammo/lot selector (optional)
- Image attachment per group

**Step 4: Review & Save**
- Summary of entered data
- Notes field
- Session images upload
- Save button

#### Session Edit
- Same form as create, pre-populated
- Can add/remove DOPE, chrono, groups
- Delete individual entries

### 4. Rifles

#### Rifle List
- Search bar
- Cards showing:
  - Name
  - Caliber
  - Thumbnail (if set)
  - Session count badge
- Swipe to delete (with confirmation, warns if has sessions)
- Tap for detail

#### Rifle Detail
- Image gallery (if images)
- Specs sections:
  - Basic: Name, manufacturer, model, caliber
  - Barrel: Length, twist rate
  - Optic: Make, model, scope height
  - Zero: Distance, clicks
  - Ballistics: MV, BC, drag model
- **Ammunition section:**
  - "View Ammunition" button â†’ Ammunition list
- **Sessions section:**
  - Recent sessions for this rifle (3-5)
  - "View All Sessions" â†’ filtered session list
- Edit button
- Delete button

#### Rifle Form
- Image picker (camera or library)
- Basic info fields
- Barrel fields
- Optic fields (collapsible)
- Zero fields (collapsible)
- Ballistic fields (collapsible)
- Validation on required fields

### 5. Ammunition

#### Ammunition List
- Search bar
- Filter by caliber
- Cards showing:
  - Name
  - Manufacturer
  - Caliber
  - Grain
  - Lot count badge
- Swipe to delete (warns if has sessions)

#### Ammunition Detail
- Basic info
- Ballistic info (BC, drag model)
- Cost info
- **Lots section:**
  - List of lots with lot number, purchase date, quantity
  - Swipe to delete lot
  - Add lot button
- **Sessions section:**
  - Recent sessions using this ammo
  - "View All" â†’ filtered sessions
- Edit / Delete buttons

#### Ammunition Form
- Manufacturer, name, caliber, grain
- Bullet type
- BC, drag model
- Cost per round

#### Lot Form (Sheet)
- Lot number
- Purchase date
- Initial quantity
- Purchase price (calculates cost per round)
- Notes

### 6. Analytics

#### Analytics Dashboard
- Summary cards:
  - Total sessions
  - Total rounds
  - Unique rifles used
  - Unique ammo tested
  - Cost spent (if tracking)
- Navigation to detailed views:
  - DOPE Charts
  - Velocity Trends
  - Ammo Comparison
  - Lot Comparison
  - Cost Analysis

#### DOPE Chart
- Rifle selector
- Ammo filter (optional)
- Date range filter
- Chart: Distance vs Elevation (line/scatter)
- Toggle: Elevation / Windage
- Export data (share sheet)

#### Velocity Trends
- Ammo selector
- Lot filter (optional)
- Date range
- Chart: Date vs Average Velocity (line)
- Stats summary: Overall avg, SD trend

#### Ammo Comparison
- Multi-select ammo (2-5 types)
- Bar charts:
  - Average velocity
  - SD comparison
  - Group size (if data)

#### Lot Comparison
- Ammo selector
- Shows all lots for that ammo
- Comparison charts: velocity, SD by lot

#### Cost Analysis
- Summary: Total spent, average per session
- Breakdown by rifle
- Breakdown by ammo
- Rounds fired timeline

### 7. Settings

#### Profile
- Display name, email
- Edit profile button â†’ form
- Change password button â†’ form

#### Preferences
- **Distance**: Yards / Meters (picker)
- **Adjustments**: MOA / MIL (picker)
- **Temperature**: Â°F / Â°C (picker)
- **Pressure**: inHg / hPa (picker)
- **Velocity**: fps / m/s (picker)
- Save automatically on change

#### Locations
- **My Locations** list
  - Swipe to delete
  - Tap for detail
  - Add button
- **Shared Locations** button
  - Browse list
  - "Copy to My Locations" action

#### Location Form
- Name
- "Use Current Location" button (GPS)
- Manual lat/lon entry
- Altitude
- Description
- Map preview (static)

#### About
- App version, build
- "View on Web" link
- "Contact Support" link
- "Privacy Policy" link
- "Terms of Service" link

#### Logout
- Confirmation alert
- Clears tokens, navigates to login

---

## User Preferences & Unit Handling

### Preferences Model

```swift
struct UserPreferences: Codable {
    var distanceUnit: DistanceUnit      // yards, meters
    var adjustmentUnit: AdjustmentUnit  // moa, mil
    var temperatureUnit: TemperatureUnit // fahrenheit, celsius
    var pressureUnit: PressureUnit      // inhg, hpa
    var velocityUnit: VelocityUnit      // fps, mps
}

enum DistanceUnit: String, Codable, CaseIterable {
    case yards, meters
}

enum AdjustmentUnit: String, Codable, CaseIterable {
    case moa, mil
}

// etc.
```

### Unit Conversion Utility

```swift
struct UnitConverter {
    static func displayDistance(_ yards: Int, in unit: DistanceUnit) -> String
    static func displayTemperature(_ fahrenheit: Decimal, in unit: TemperatureUnit) -> String
    static func displayPressure(_ inHg: Decimal, in unit: PressureUnit) -> String
    static func displayVelocity(_ fps: Decimal, in unit: VelocityUnit) -> String
    static func displayAdjustment(_ mils: Decimal, in unit: AdjustmentUnit) -> String

    // Input conversion (user input â†’ API format)
    static func toYards(_ value: Int, from unit: DistanceUnit) -> Int
    static func toFahrenheit(_ value: Decimal, from unit: TemperatureUnit) -> Decimal
    // etc.
}
```

**Important**: Backend stores everything in base units (yards, Â°F, inHg, fps, MIL). iOS converts for display based on user preferences.

---

## Image Handling

### Upload Flow

1. User taps "Add Image" button
2. ImagePicker presents (camera or library)
3. Selected image is compressed (max 2048px, JPEG 80%)
4. Upload via `POST /api/images/{entityType}/{entityId}`
5. Multipart form data with image bytes
6. Response includes image ID and URLs
7. Update local model with new image

### Display

- Use `SDWebImageSwiftUI` for async loading
- Show thumbnails in lists/cards
- Full images in galleries with zoom
- Placeholder while loading
- Error state if load fails

### HEIC Handling

Backend handles HEICâ†’JPEG conversion. iOS can upload HEIC directly.

---

## Offline Considerations

**Phase 13 Scope: Online-only**

The app requires network connectivity for all operations. No local persistence beyond:
- Auth tokens (Keychain)
- User preferences (UserDefaults)
- Image cache (SDWebImage disk cache)

**Future Enhancement (not in scope):**
- SwiftData for local session cache
- Sync queue for offline-created sessions
- Conflict resolution strategy

For Phase 13, show appropriate offline messaging:
- Network reachability monitoring (NWPathMonitor)
- "No internet connection" banner when offline
- Disable create/edit actions when offline
- Cache last-fetched lists briefly (in-memory)

---

## Testing Strategy

### Unit Tests (Required)

**Core Services:**
- `AuthServiceTests` - Login, register, token refresh flows
- `TokenManagerTests` - Token storage, retrieval, expiry checks
- `APIClientTests` - Request building, response parsing, error handling

**Domain Services:**
- `RifleServiceTests` - CRUD operations, error cases
- `SessionServiceTests` - Complex session operations
- `AmmunitionServiceTests` - Ammo and lot operations

**ViewModels:**
- `LoginViewModelTests` - Validation, login flow, error states
- `SessionsListViewModelTests` - Loading, filtering, pagination
- `SessionCreateViewModelTests` - Multi-step form logic
- `RiflesListViewModelTests` - Search, delete flow

**Utilities:**
- `UnitConverterTests` - All unit conversions both directions
- `ValidatorTests` - Email, password, coordinate validation

### Integration Tests (Recommended)

- API endpoint integration (with mock server or test backend)
- Auth flow end-to-end
- Session creation flow

### UI Tests (Optional/Future)

- Critical user flows:
  - Login â†’ Dashboard
  - Create session flow
  - Create rifle flow
- Accessibility audit

### Test Tooling

```swift
// Mocking pattern
protocol APIClientProtocol {
    func request<T: Decodable>(_ endpoint: APIEndpoint) async throws -> T
}

class MockAPIClient: APIClientProtocol {
    var mockResponse: Any?
    var mockError: Error?

    func request<T: Decodable>(_ endpoint: APIEndpoint) async throws -> T {
        if let error = mockError { throw error }
        return mockResponse as! T
    }
}
```

### Test Data

Create `TestData.swift` with factory methods:
```swift
enum TestData {
    static func makeRifle(id: Int = 1, name: String = "Test Rifle") -> RifleSetup
    static func makeSession(id: Int = 1, date: String = "2024-12-17") -> RangeSession
    static func makeAmmo(id: Int = 1, name: String = "Test Ammo") -> Ammunition
    // etc.
}
```

---

## Implementation Phases

### Phase 13.1: Project Reset & Core Setup
- [ ] Delete all existing Swift code (keep xcodeproj, assets, plist)
- [ ] Create new folder structure
- [ ] Update SPM dependencies (Alamofire 5.9+, SDWebImageSwiftUI 3.0+)
- [ ] Remove third-party Charts (use Swift Charts)
- [ ] Create `Config.swift` with environment configuration
- [ ] Create `TrueDope_iOSApp.swift` entry point
- [ ] Create `AppState.swift` for global state
- [ ] Verify project builds and runs (empty app)

### Phase 13.2: Core Networking Layer
- [ ] Create `APIClient.swift` with Alamofire
- [ ] Create `APIEndpoints.swift` enum
- [ ] Create `APIResponse.swift` wrapper types
- [ ] Create `APIError.swift` error types
- [ ] Implement request/response logging (debug)
- [ ] Write `APIClientTests`

### Phase 13.3: Authentication
- [ ] Create `KeychainService.swift`
- [ ] Create `TokenManager.swift`
- [ ] Create `AuthService.swift`
- [ ] Implement login flow
- [ ] Implement register flow
- [ ] Implement token refresh
- [ ] Implement logout
- [ ] Create `LoginView.swift` and `LoginViewModel.swift`
- [ ] Create `RegisterView.swift` and `RegisterViewModel.swift`
- [ ] Implement auth state in `AppState`
- [ ] Write auth tests

### Phase 13.4: Navigation Shell
- [ ] Create `MainTabView.swift` with 4 tabs
- [ ] Create placeholder views for each tab
- [ ] Implement auth-gated navigation (login vs main)
- [ ] Create common components: `LoadingView`, `ErrorView`, `EmptyStateView`
- [ ] Test navigation flow

### Phase 13.5: Models & Services
- [ ] Create all model structs (matching backend DTOs)
- [ ] Create `RifleService.swift`
- [ ] Create `AmmunitionService.swift`
- [ ] Create `SessionService.swift`
- [ ] Create `LocationService.swift`
- [ ] Create `WeatherService.swift`
- [ ] Create `ImageService.swift`
- [ ] Create `UserService.swift`
- [ ] Create `AnalyticsService.swift`
- [ ] Write service tests

### Phase 13.6: Rifles Feature
- [ ] Create `RiflesListView` + ViewModel
- [ ] Create `RifleDetailView` + ViewModel
- [ ] Create `RifleFormView` + ViewModel
- [ ] Create `RifleCard` component
- [ ] Implement search, pagination
- [ ] Implement create, edit, delete
- [ ] Implement image upload for rifles
- [ ] Write rifle ViewModel tests

### Phase 13.7: Ammunition Feature
- [ ] Create `AmmunitionListView` + ViewModel
- [ ] Create `AmmunitionDetailView` + ViewModel
- [ ] Create `AmmunitionFormView` + ViewModel
- [ ] Create `LotFormView` (sheet)
- [ ] Create `AmmoCard`, `LotRow` components
- [ ] Implement lot management
- [ ] Write ammunition ViewModel tests

### Phase 13.8: Sessions Feature - List & Detail
- [x] Create `SessionsListView` + ViewModel
- [x] Create `SessionDetailView` + ViewModel
- [x] Create `SessionCard` component
- [x] Implement filtering (data type filters)
- [x] Implement search
- [x] Implement pagination
- [x] Implement delete with confirmation
- [x] Create condition display components (`ConditionsSection`, `ConditionsBadge`)
- [x] Create DOPE, Chrono, Group display components (`DopeEntryRow`, `ChronoDataSection`, `GroupEntryRow`)
- [x] Add image gallery with upload to SessionDetailView
- [x] Update RifleDetailView sessions section to show actual sessions

### Ph1.ase 13.9: Sessions Feature - Create & Edit
- [ ] Create `SessionCreateView` + ViewModel (multi-step)
- [ ] Create `SessionEditView` + ViewModel
- [ ] Create `DopeEntryForm` component
- [ ] Create `ChronoSessionForm` component
- [ ] Create `GroupEntryForm` component
- [ ] Create `LocationPicker` component
- [ ] Implement GPS location capture
- [ ] Wire up Edit button in SessionDetailView toolbar to navigate to SessionEditView
- [ ] Implement inline delete for DOPE entries (swipe to delete in detail view)
- [ ] Implement inline delete for chrono sessions
- [ ] Implement inline delete for group entries
- [ ] Implement inline delete for velocity readings
- [ ] Write session ViewModel tests

### Phase 13.10: Settings Feature
- [ ] Create `SettingsView`
- [ ] Create `ProfileView` + edit form
- [ ] Create `PreferencesView` with unit selectors
- [ ] Implement preferences save/load
- [ ] Create `LocationsListView` for saved locations
- [ ] Create `LocationFormView`
- [ ] Create shared locations browser
- [ ] Create `AboutView`
- [ ] Implement logout

### Phase 13.11: User Preferences Integration
- [ ] Create `UnitConverter` utility
- [ ] Update all views to use user's preferred units
- [ ] Test unit display throughout app
- [ ] Write unit converter tests

### Phase 13.12: Home Dashboard
- [ ] Create `DashboardView` + ViewModel
- [ ] Implement recent sessions section
- [ ] Implement quick actions
- [ ] Implement summary stats
- [ ] Pull-to-refresh

### Phase 13.13: Analytics Feature
- [ ] Create `AnalyticsView` dashboard
- [ ] Create `DopeChartView` with Swift Charts
- [ ] Create `VelocityTrendsView`
- [ ] Create `AmmoComparisonView`
- [ ] Create `LotComparisonView`
- [ ] Create `CostAnalysisView`
- [ ] Implement chart interactions (selection, zoom)

### Phase 13.14: Polish & Error Handling
- [ ] Implement network reachability monitoring
- [ ] Add offline messaging
- [ ] Review all error states
- [ ] Add haptic feedback where appropriate
- [ ] Review accessibility (VoiceOver, Dynamic Type)
- [ ] Dark mode verification
- [ ] Landscape support (iPad consideration)

### Phase 13.15: Testing & QA
- [ ] Complete all unit tests
- [ ] Run tests, fix failures
- [ ] Manual testing of all flows
- [ ] Test on multiple device sizes (iPhone SE, Pro Max)
- [ ] Test iOS 16 compatibility
- [ ] Performance profiling
- [ ] Memory leak check

### Phase 13.16: Release Preparation
- [ ] Update app icon if needed
- [ ] Update version number
- [ ] Update release notes
- [ ] Archive and test on physical device
- [ ] TestFlight submission
- [ ] Beta testing round

---

## Risk Mitigation

| Risk | Mitigation |
|------|------------|
| API changes during development | Coordinate with backend, version API |
| iOS 16 compatibility issues | Test early on iOS 16 simulator |
| Swift Charts limitations | Have fallback to custom chart views |
| Large image upload failures | Compress images, chunked upload if needed |
| Token refresh race conditions | Queue requests during refresh |
| Complex session form UX | User testing, iterate on design |

---

## Success Criteria

- [ ] All CRUD operations work for rifles, ammo, sessions, locations
- [ ] Session creation captures DOPE, chrono, and group data
- [ ] Weather auto-fetch works
- [ ] All analytics charts display correctly
- [ ] User preferences (units) apply throughout app
- [ ] Image upload/display works
- [ ] Auth flow is smooth (login, register, refresh, logout)
- [ ] App handles errors gracefully
- [ ] App works on iOS 16+
- [ ] All unit tests pass
- [ ] No critical bugs in TestFlight

---

## Decisions

1. **Biometric auth**: **YES** - Implement Face ID/Touch ID for quick login in Phase 13.3. Store refresh token securely, use biometric to unlock and auto-login.

2. **Push notifications**: **DEFERRED** - No clear use case yet. Future possibilities: session reminders, weather alerts for saved locations, lot expiration warnings. Revisit when there's a compelling reason.

3. **Widget support**: **DEFERRED** - Nice to have for quick session logging or viewing recent DOPE. Future phase consideration.

4. **Apple Watch**: **FUTURE PHASE** - Exciting potential for quick DOPE reference at the range. Imagine glancing at your wrist to see elevation holds for your current rifle/ammo. Would require:
   - watchOS companion app
   - Sync selected rifle's DOPE chart to watch
   - Complications for quick access
   - Offline data (watch may not have connectivity at range)
   - This is a compelling v3 feature, not in Phase 13 scope.

5. **iPad optimization**: **BASIC NOW, OPTIMIZE LATER** - App will run on iPad with default scaling. Full iPad optimization (sidebar navigation, multi-column layouts, keyboard shortcuts) deferred to future phase.

---

## Appendix: File Deletion List

The following paths should be deleted in Phase 13.1:

```
TrueDope-iOS/TrueDope-iOS/App/TrueDope_iOSApp.swift
TrueDope-iOS/TrueDope-iOS/Models/ (entire directory)
TrueDope-iOS/TrueDope-iOS/ViewModels/ (entire directory)
TrueDope-iOS/TrueDope-iOS/Views/ (entire directory)
TrueDope-iOS/TrueDope-iOS/Services/ (entire directory)
TrueDope-iOS/TrueDope-iOS/Utilities/ (entire directory)
```

**Keep:**
```
TrueDope-iOS/TrueDope-iOS.xcodeproj/
TrueDope-iOS/TrueDope-iOS/Info.plist
TrueDope-iOS/TrueDope-iOS/Resources/Assets.xcassets/
TrueDope-iOS/TrueDope-iOS/Config.plist.template
TrueDope-iOS/TrueDope-iOS.entitlements (if exists)
```

---

## Changelog

| Date | Change |
|------|--------|
| 2024-12-17 | Initial Phase 13 specification created |
