# Phase 13.12: Home Dashboard

**Created**: December 23, 2024
**Status**: Complete
**Parent**: [20251217.Phase13.iOSOverhaul.md](./20251217.Phase13.iOSOverhaul.md)

---

## Overview

Implement the Home Dashboard tab for the TrueDope iOS app. The dashboard serves as the primary landing screen, providing users with a quick overview of their shooting data, recent activity, and quick actions to common tasks.

---

## Current State

### What Exists
- `DashboardView.swift` - Placeholder UI with hardcoded values
- `DashboardViewModel.swift` - Fully implemented but **not connected** to the view
- `AnalyticsService.swift` - `getSummary()` method ready to fetch dashboard data
- `SessionService.swift` - `getRecentSessions(count:)` method available
- `AnalyticsSummary` model - Complete with all required fields

### What's Missing
- DashboardView doesn't use DashboardViewModel
- No real data displayed (all hardcoded "0" values)
- Quick action buttons have no navigation
- No empty state handling
- No loading/error states
- Recent sessions section is placeholder only

---

## Design Decisions

### 1. Summary Stats Layout (Two Rows)

**Top Row - Activity Counts:**
| Stat | Data Source | Icon |
|------|-------------|------|
| Total Sessions | `summary.totalSessions` | `list.bullet.clipboard` |
| Total Rounds | `summary.totalRoundsFired` | `circle.fill` (bullet) |

**Bottom Row - Achievements/Records:**
| Stat | Data Source | Icon |
|------|-------------|------|
| Longest Shot | `summary.longestShot?.distance` + rifle name | `scope` |
| Best Group | `summary.bestGroup?.sizeMoa` + distance | `target` |

**Empty State**: Achievement cards show "No data yet" with muted styling.

### 2. Recent Sessions Display

**Vertical list** (not horizontal scroll) showing last 5 sessions:
- Consistent with Sessions tab visual language
- More information density
- Easier to tap on mobile
- Uses existing `SessionCard` component

Each card shows:
- Date
- Rifle name
- Location (if set)
- Data type badges (DOPE, Chrono, Groups)
- Conditions summary (temp, wind)

### 3. Quick Actions

Two prominent buttons:
- **New Session**: Navigates to `SessionCreateView` (Phase 13.9 dependency - show placeholder if not ready)
- **View Analytics**: Navigates to `AnalyticsView` (Phase 13.13 dependency - show placeholder if not ready)

Since Phase 13.9 (Session Create) and 13.13 (Analytics) aren't complete, buttons will navigate to placeholder views with "Coming Soon" messaging.

### 4. Empty State Handling

When user has no data:
- Show "Get Started" section with guidance
- Prominent "Add Your First Rifle" button (rifles are prerequisite for sessions)
- Summary cards show "0" with appropriate messaging
- Recent sessions shows empty state illustration

### 5. Pull-to-Refresh

- Refreshes both summary stats AND recent sessions
- Shows native SwiftUI refresh indicator
- No toast on completion (iOS convention - silent success)
- Error shown via banner if refresh fails

### 6. Loading States

- Initial load: Full-screen loading indicator
- Subsequent loads: Pull-to-refresh indicator only
- Skeleton loading not required (data loads quickly)

---

## Implementation Tasks

### Task 1: Connect DashboardViewModel to DashboardView
- [x] Add `@StateObject` for DashboardViewModel in DashboardView
- [x] Add `.task` modifier to load data on appear
- [x] Implement `.refreshable` with actual refresh logic
- [x] Handle loading state (show LoadingView during initial load)
- [x] Handle error state (show ErrorView with retry)

### Task 2: Implement Summary Stats Cards
- [x] Create `SummaryStatsSection` component
- [x] Create `StatCard` component (reusable)
- [x] Top row: Sessions count, Rounds count
- [x] Bottom row: Longest Shot, Best Group
- [x] Handle nil/empty data gracefully
- [x] Apply user's unit preferences (distance units)

### Task 3: Implement Recent Sessions Section
- [x] Create `RecentSessionsSection` component
- [x] Use existing `SessionCard` component
- [x] Show last 5 sessions
- [x] "View All" button navigates to Sessions tab
- [x] Handle empty state (no sessions yet)
- [x] Tap navigates to SessionDetailView

### Task 4: Implement Quick Actions Section
- [x] Create `QuickActionsSection` component
- [x] "New Session" button with SF Symbol
- [x] "View Analytics" button with SF Symbol
- [x] Navigation to appropriate views (or placeholders)
- [x] Style as prominent action buttons

### Task 5: Implement Empty/Onboarding State
- [x] Detect when user has no data (0 sessions, 0 rifles)
- [x] Show "Get Started" section
- [x] "Add Your First Rifle" button â†’ RifleFormView
- [x] Friendly illustration/messaging

### Task 6: Navigation Setup
- [x] SessionDetailView navigation from recent sessions
- [x] SessionCreateView navigation (or placeholder)
- [x] AnalyticsView navigation (or placeholder)
- [x] RifleFormView navigation for onboarding
- [x] Sessions tab switch for "View All"

### Task 7: Unit Preferences Integration
- [x] Use `UnitFormatter` for distance display (Longest Shot)
- [x] Respect user's distance unit preference (yards/meters)

### Task 8: Polish & Edge Cases
- [x] Test with various data states (empty, partial, full)
- [x] Verify Dark Mode appearance
- [x] Verify Dynamic Type scaling
- [x] Test pull-to-refresh behavior
- [x] Test navigation flows

---

## File Changes

### Modified Files
| File | Changes |
|------|---------|
| `Features/Dashboard/DashboardView.swift` | Complete rewrite to use ViewModel and real data |
| `Features/Common/MainTabView.swift` | May need state for tab switching |

### New Files
| File | Purpose |
|------|---------|
| `Features/Dashboard/Components/SummaryStatsSection.swift` | Stats cards container |
| `Features/Dashboard/Components/StatCard.swift` | Individual stat card |
| `Features/Dashboard/Components/RecentSessionsSection.swift` | Recent sessions list |
| `Features/Dashboard/Components/QuickActionsSection.swift` | Action buttons |
| `Features/Dashboard/Components/DashboardEmptyState.swift` | Onboarding/empty view |

### Placeholder Files (if needed)
| File | Purpose |
|------|---------|
| `Features/Sessions/SessionCreateView.swift` | Placeholder until Phase 13.9 |
| `Features/Analytics/AnalyticsView.swift` | Placeholder until Phase 13.13 |

---

## Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DashboardView                         â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              DashboardViewModel                  â”‚   â”‚
â”‚  â”‚                                                  â”‚   â”‚
â”‚  â”‚  @Published summary: AnalyticsSummary?          â”‚   â”‚
â”‚  â”‚  @Published recentSessions: [SessionListItem]   â”‚   â”‚
â”‚  â”‚  @Published isLoading: Bool                     â”‚   â”‚
â”‚  â”‚  @Published error: String?                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                         â”‚                               â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚            â–¼                         â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ AnalyticsServiceâ”‚      â”‚  SessionService â”‚         â”‚
â”‚  â”‚  .getSummary()  â”‚      â”‚.getRecentSessionsâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚            â”‚                         â”‚                 â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                         â–¼                               â”‚
â”‚                   Backend API                           â”‚
â”‚         GET /api/analytics/summary                      â”‚
â”‚         GET /api/sessions?pageSize=5                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## UI Mockup (ASCII)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home                              [ğŸ‘¤]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ“‹          â”‚  â”‚ â—           â”‚      â”‚
â”‚  â”‚ 47          â”‚  â”‚ 2,340       â”‚      â”‚
â”‚  â”‚ Sessions    â”‚  â”‚ Rounds      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ¯          â”‚  â”‚ â—           â”‚      â”‚
â”‚  â”‚ 1,200 yds   â”‚  â”‚ 0.42 MOA    â”‚      â”‚
â”‚  â”‚ Longest Shotâ”‚  â”‚ Best Group  â”‚      â”‚
â”‚  â”‚ Tikka T3x   â”‚  â”‚ @ 100 yds   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â”‚  â”€â”€ Quick Actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â•  New Session                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ğŸ“Š  View Analytics              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                         â”‚
â”‚  â”€â”€ Recent Sessions â”€â”€â”€â”€â”€â”€ View All â†’  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Dec 20, 2024                    â”‚   â”‚
â”‚  â”‚ Tikka T3x CTR Â· Home Range      â”‚   â”‚
â”‚  â”‚ [DOPE] [Chrono]      72Â°F 5mph  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Dec 18, 2024                    â”‚   â”‚
â”‚  â”‚ Ruger Precision Â· Public Range  â”‚   â”‚
â”‚  â”‚ [Groups]             65Â°F 2mph  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ...                                    â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ     ğŸ“‹    ğŸ”«    âš™ï¸                   â”‚
â”‚ Home Sessions Rifles Settings           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Empty State Mockup

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Home                              [ğŸ‘¤]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ“‹          â”‚  â”‚ â—           â”‚      â”‚
â”‚  â”‚ 0           â”‚  â”‚ 0           â”‚      â”‚
â”‚  â”‚ Sessions    â”‚  â”‚ Rounds      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ¯          â”‚  â”‚ â—           â”‚      â”‚
â”‚  â”‚ --          â”‚  â”‚ --          â”‚      â”‚
â”‚  â”‚ Longest Shotâ”‚  â”‚ Best Group  â”‚      â”‚
â”‚  â”‚ No data yet â”‚  â”‚ No data yet â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                         â”‚
â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚     ğŸ¯          â”‚            â”‚
â”‚         â”‚                 â”‚            â”‚
â”‚         â”‚  Welcome to     â”‚            â”‚
â”‚         â”‚  TrueDope!      â”‚            â”‚
â”‚         â”‚                 â”‚            â”‚
â”‚         â”‚  Add your first â”‚            â”‚
â”‚         â”‚  rifle to start â”‚            â”‚
â”‚         â”‚  logging data   â”‚            â”‚
â”‚         â”‚                 â”‚            â”‚
â”‚         â”‚ [Add Rifle]     â”‚            â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                         â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ     ğŸ“‹    ğŸ”«    âš™ï¸                   â”‚
â”‚ Home Sessions Rifles Settings           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Dependencies

### Required (Already Complete)
- [x] Phase 13.5: Models & Services (AnalyticsService, SessionService)
- [x] Phase 13.8: Sessions List & Detail (SessionCard, SessionDetailView)
- [x] Phase 13.6: Rifles Feature (RifleFormView for onboarding)
- [x] Phase 13.11: User Preferences (UnitFormatter)

### Optional (Can Use Placeholders)
- [ ] Phase 13.9: Session Create & Edit (New Session button)
- [ ] Phase 13.13: Analytics Feature (View Analytics button)

---

## Testing Checklist

### Functional Tests
- [ ] Dashboard loads summary data on appear
- [ ] Dashboard loads recent sessions on appear
- [ ] Pull-to-refresh updates both summary and sessions
- [ ] Tap on session card navigates to detail
- [ ] "View All" navigates to Sessions tab
- [ ] "New Session" navigation works
- [ ] "View Analytics" navigation works
- [ ] "Add Rifle" works in empty state
- [ ] Unit preferences applied to distances

### State Tests
- [ ] Loading state displays correctly
- [ ] Error state displays with retry option
- [ ] Empty state (no data) displays correctly
- [ ] Partial data (some nil values) handles gracefully

### UI Tests
- [ ] Dark Mode appearance correct
- [ ] Dynamic Type scales properly
- [ ] Cards have proper spacing and alignment
- [ ] SF Symbols display correctly

---

## Success Criteria

- [x] Dashboard displays real data from backend
- [x] All four stat cards show accurate information
- [x] Recent sessions load and display correctly
- [x] Navigation to session detail works
- [x] Quick actions navigate appropriately
- [x] Empty state provides clear onboarding path
- [x] Pull-to-refresh works smoothly
- [x] Unit preferences respected for distances
- [x] No hardcoded placeholder values remain

---

## Changelog

| Date | Change |
|------|--------|
| 2024-12-23 | Initial Phase 13.12 specification created |
| 2024-12-25 | Implementation complete - all components built and verified |
