# Bugs and Features - December 30, 2025

## iOS App Bugs

### 1. Velocity Analytics - Multi-Rifle Per Caliber Issue
**Status:** Open

Velocity trends and analytics were designed assuming one rifle per ammo type. However, the same ammo (e.g., 77g OTM) produces very different velocities from different barrel lengths (14.5" vs 10.3").

**Decision:** Add a global rifle filter at the top of the Analytics tab.

**Implementation Approach:**
- Phase 1: Global rifle selector at top of Analytics tab (defaults to "All" or last-used)
- Phase 2 (future): Per-chart override capability if users request it

**Note:** This applies to other analytics tools that currently assume one rifle per caliber.

---

### 2. Group Measurement - Duplicate Thumbnails
**Status:** Open
**Reproducibility:** All groups (confirmed)

Creating a group spawns two thumbnails afterward that are both just a pic of the target.

**Expected Behavior:**
- One thumbnail: original pic of the target
- Second thumbnail: overlay with bullet holes, POA, and measurement widget

---

## iOS App Features

### 3. Pin Drop for New Locations
**Priority:** Enhancement

Instead of "Shared Locations" being an option in the sessions page, add an option for users to drop a pin on locations they've shot at previously but aren't currently at.

**Approach:** Integrated (matching webapp pattern)

The webapp's `LocationCombobox` provides a unified location picker with multiple sources. iOS should mirror this:

**Session Creation - Location Picker Options:**
1. **My Locations** - user's saved locations
2. **Current Location** - GPS button for immediate location
3. **Search/Drop Pin** - opens MapKit view for:
   - Geocoding search (type address/place name)
   - Tap-to-place pin anywhere on map
   - Drag pin to fine-tune position
   - After confirming, prompt: "Save this location for future use?"

**Dedicated Location Management:**
- Keep existing Settings > Data > Saved Locations
- Add "+" button to create location outside session context
- Same map picker UI as session flow

**Key UX Details (from webapp):**
- Auto-fetch elevation when pin is placed (use elevation API)
- Draggable pin for fine-tuning
- Show lat/lng coordinates in real-time for verification
- Geocoding search with debounce (300ms, min 3 chars)
- Location preview on map before saving

**Technical Notes:**
- Use MapKit for iOS map integration
- Elevation API: consider Open-Elevation or similar
- Store coordinates with high precision (match webapp: 8 decimal places)

**Reference Files (webapp implementation):**
- `TrueDope/frontend/src/components/location/LocationCombobox.tsx` - unified picker
- `TrueDope/frontend/src/components/map/LocationPicker.tsx` - interactive map
- `TrueDope/frontend/src/pages/locations/LocationForm.tsx` - location creation

---

### 4. Group Measurement Tool - Pinch to Zoom
**Priority:** UX Enhancement

The group measurement tool should allow the user to pinch to zoom when establishing bullet holes or POA.

Additionally, the current green circles for the bullet markers are a bit large.  In Ballistic X, before setting your impacts (but after setting caliber), I believe you're able to select your caliber type FIRST, which actually then leads you to set the impacts.  With the caliber set and 1 inch reference point already established, it's able to scale the bullet impact (green circle) size to be just about exactly the size of the bullet impacts. This helps a ton with preventing the green impact holes from overcrowding.

---

### 5. Group Measurement - Overlay Widget & Export
**Priority:** Feature

The measurement tool should allow the user to place a widget on top of their group pic (similar to Ballistic X).

**Requirements:**
- Widget overlay showing measurements
- Image with overlay saved to the group
- User should be able to export this image

**Widget Stats (Customizable):**
- Group size (inches/mm)
- MOA/MIL equivalent
- Mean radius
- Shot count
- Distance
- Date/time stamp
- Rifle/ammo info

**Configuration Approach:** Default + Override
- Global defaults configured in Settings > Export Preferences
- Per-export override available when exporting (tap to customize before saving/sharing)

---

### 6. Computer Vision Auto-Measure Group Size
**Priority:** Future Feature

Use computer vision to auto-measure ES (extreme spread) of group sizes.

**Scale Reference Approach:** QR Target System
- Design custom targets with encoded scale markers for accurate measurement
- Distribution: Both printable PDFs (free) and physical targets (premium/sold)

**Considerations:**
- Auto mean radius unlikely (can't auto-place shots)
- Could auto-detect total group size
- Wouldn't be center-to-center (current method)
- If user supplies bullet diameter, radius could be subtracted (×2) from total size

**Proposed Flow:**
1. User shoots group
2. User creates session in TrueDope
3. User initiates group measurement and takes photo of target
4. App detects QR markers and establishes scale
5. App measures total size of group and provides that value
6. App lets user place individual shots and POA to calculate mean radius (optional)
7. User specifies range and number of shots (probably earlier in process)

**Target Design Considerations:**
- Multiple target sizes (pistol, rifle, precision)
- QR-like markers in corners for scale + orientation detection
- Aiming points that work for various disciplines
- Could partner with existing target manufacturers

---

### 7. Summary Cards - Make Functional
**Priority:** UX Enhancement

Make the Summary cards on the home screen functional/tappable.

**Requirements:**
- Sessions card → navigates to sessions page
- Longest Shot card → navigates to session with longest shot
- Best Group card → navigates to session with best group

---

## Strategic Considerations

### 8. Data Value for Manufacturers
**Priority:** Business/Strategic

Position the app to provide valuable anonymized aggregate data for:
- Ammo manufacturers
- Barrel/rifle manufacturers

**Data Strategy:** Anonymized Aggregates
- No individual user data shared
- Statistical trends across user base (e.g., "average velocity for Federal GMM 77gr across 1,000+ users")
- Requires sufficient user base to be statistically meaningful

**Potential Data Points:**
- Velocity statistics by ammo type (mean, SD, ES)
- Velocity vs barrel length correlations
- Group size distributions by ammo/rifle combo
- Popular rifle/ammo pairings
- Regional usage patterns (anonymized)

**Privacy Considerations:**
- Clear privacy policy about aggregate data use
- Possibly opt-out option for users who don't want to contribute
- No PII ever included in aggregates

**Business Model Options:**
- Sell reports/dashboards to manufacturers
- Partner with manufacturers for sponsored ammo database entries
- Offer "verified by TrueDope" badge for manufacturer claims
