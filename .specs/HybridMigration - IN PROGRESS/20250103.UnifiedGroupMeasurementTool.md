# Unified Group Measurement Tool

**Created:** 2025-01-03
**Status:** Specification
**Priority:** High

## Overview

This specification defines the consolidation of the iOS app's two separate group measurement flows (online `GroupMeasurementFlow` and offline `OfflineGroupMeasurementFlow`) into a **single wizard** that works seamlessly in both online and offline contexts.

### Current Problem

The app currently has two separate implementations:

1. **Online GroupMeasurementFlow** (`GroupMeasurementFlow.swift`, `GroupMeasurementViewModel.swift`)
   - Requires network connectivity for metrics calculation (API call)
   - Uses `GroupMeasurement` model (server response)
   - Limited to sessions already created on the server
   - **Useful code:** Annotated image generation scales hole circles to actual bullet diameter

2. **Offline OfflineGroupMeasurementFlow** (`OfflineGroupMeasurementFlow.swift`, `OfflineGroupMeasurementViewModel.swift`)
   - Works without network
   - Calculates metrics locally via `LocalGroupMetricsCalculator`
   - Uses `PendingGroupMeasurement` model (local storage)
   - Supports queuing for later sync

**Issues with current dual-flow approach:**
- ~95% code duplication across two nearly-identical wizards
- Maintenance burden (every change must be made in two places)
- `AdaptiveGroupMeasurementFlow` adds routing complexity
- Different code paths = potential for divergent behavior

### Solution: Single Unified Wizard

Consolidate into **one wizard** that:
- Works in both online AND offline contexts (same code path)
- Uses `LocalGroupMetricsCalculator` for all calculations (no API dependency for metrics)
- Supports three invocation contexts: synced sessions, pending sessions, standalone
- Syncs to server automatically when online, queues when offline
- Single codebase = easier maintenance and consistent UX

---

## Architecture

### Core Principle: Calculate Local, Sync Smart

```
┌─────────────────────────────────────────────────────────────┐
│               Single GroupMeasurementFlow                    │
│                                                              │
│  Capture → Calibrate → Mark Holes → Metadata → Review       │
│                                                              │
│  All calculations via LocalGroupMetricsCalculator           │
│  (No network required during the wizard)                    │
└─────────────────────────────┬────────────────────────────────┘
                              │
                              │ On Save
                              ↓
              ┌───────────────┴───────────────┐
              │      Determine Context         │
              └───────────────┬───────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        ↓                     ↓                     ↓
┌───────────────┐     ┌───────────────┐     ┌───────────────┐
│ Synced Session│     │Pending Session│     │  Standalone   │
│ (has groupId) │     │(PendingEntry) │     │ (no session)  │
│               │     │               │     │               │
│ If online:    │     │ Save locally  │     │ Save locally  │
│  → Sync now   │     │ to pending    │     │ as standalone │
│ If offline:   │     │ session       │     │ measurement   │
│  → Queue sync │     │               │     │               │
└───────────────┘     └───────────────┘     └───────────────┘
```

**All measurement operations happen locally:**
- Image capture and storage: Local
- Calibration: Local
- Hole marking: Local
- Metrics calculation: Local (`LocalGroupMetricsCalculator`)
- Annotated image generation: Local
- Sync to server: On save, based on context and connectivity

### Files to Consolidate/Modify

**Remove (deprecated):**
- `GroupMeasurementFlow.swift`
- `GroupMeasurementViewModel.swift`
- `HoleMarkingView.swift` (integrated into unified flow)

**Keep and Enhance:**
- `OfflineGroupMeasurementFlow.swift` → Rename to `GroupMeasurementFlow.swift`
- `OfflineGroupMeasurementViewModel.swift` → Rename to `GroupMeasurementViewModel.swift`
- `LocalGroupMetricsCalculator.swift` (unchanged)
- `HoleMarker.swift`, `POAMarker.swift` (shared components, unchanged)

**Remove Routing Logic:**
- `AdaptiveGroupMeasurementFlow.swift` (no longer needed - only one flow)

### ViewModel Design

```swift
@MainActor
class GroupMeasurementViewModel: ObservableObject {
    // MARK: - Context (how the tool was invoked)

    /// For standalone measurement (no existing session)
    init(groupNumber: Int = 1, distance: Int = 100)

    /// For adding measurement to pending offline session
    init(pendingGroupEntry: PendingGroupEntry)

    /// For adding measurement to existing synced session
    init(groupEntry: GroupEntry)  // NEW: supports synced sessions

    // MARK: - Wizard Steps
    enum Step: Int, CaseIterable {
        case capture = 0      // Take or select photo
        case calibration = 1  // Set reference distance
        case markHoles = 2    // Mark POA and bullet holes
        case metadata = 3     // Distance, bullet diameter
        case review = 4       // View results, save
    }

    // MARK: - Calibration
    @Published var calibrationPoint1: CGPoint?
    @Published var calibrationPoint2: CGPoint?
    @Published var referenceDistanceInches: Decimal = 1.0
    @Published var pixelsPerInch: CGFloat?

    // MARK: - Hole Marking
    @Published var poaPosition: CGPoint?
    @Published var holeMarkers: [CGPoint] = []

    // MARK: - Bullet Diameter
    @Published var bulletDiameter: Decimal = 0.308
    @Published var selectedCommonDiameter: CommonBulletDiameter? = .cal308
    @Published var useCustomDiameter: Bool = false

    // MARK: - Calculated Results
    @Published var calculatedMetrics: LocalGroupMetrics?

    // MARK: - Images
    @Published var capturedImage: UIImage?
    @Published var annotatedImage: UIImage?

    // MARK: - Methods
    func calculateMetrics()           // Uses LocalGroupMetricsCalculator
    func generateAnnotatedImage()     // Creates image with markers and metrics
    func save()                        // Saves locally, queues for sync if needed
}
```

### Data Flow

```
┌─────────────────────────────────────────────────────────────┐
│                    User Invokes Tool                         │
├─────────────────────────────────────────────────────────────┤
│  From Session Detail    │   From Pending Session   │  Standalone  │
│  (synced GroupEntry)    │   (PendingGroupEntry)    │  (Quick Add) │
└───────────┬─────────────┴───────────┬──────────────┴──────┬─────┘
            │                         │                      │
            └─────────────────────────┼──────────────────────┘
                                      ↓
┌─────────────────────────────────────────────────────────────┐
│              GroupMeasurementFlow (Unified)                  │
│                                                              │
│  Step 1: Capture → Step 2: Calibrate → Step 3: Mark Holes   │
│  Step 4: Metadata → Step 5: Review & Save                   │
└─────────────────────────────────────────────────────────────┘
                                      │
                                      ↓
┌─────────────────────────────────────────────────────────────┐
│              LocalGroupMetricsCalculator                     │
│  - Extreme Spread (CTC, ETE)                                 │
│  - Mean Radius                                               │
│  - H/V Spread                                                │
│  - Standard Deviations                                       │
│  - CEP50                                                     │
│  - Centroid                                                  │
└─────────────────────────────────────────────────────────────┘
                                      │
                                      ↓
┌─────────────────────────────────────────────────────────────┐
│                    Local Storage                             │
│  - PendingGroupMeasurement (queued for sync)                │
│  - Images saved to local cache                              │
└─────────────────────────────────────────────────────────────┘
                                      │
                                      ↓ (when online)
┌─────────────────────────────────────────────────────────────┐
│                  Background Sync Service                     │
│  - POST measurement to /api/sessions/{id}/groups/{gid}/...  │
│  - Upload images to MinIO                                    │
│  - Mark as synced                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## Feature: Caliber-Scaled Hole Markers (Interactive)

### Current Behavior
Both flows currently use fixed 24pt green circles during interactive hole marking. The circles only scale to actual bullet diameter in the final annotated image.

### Enhanced Behavior
Scale hole markers in real-time during the marking step based on:
```swift
let markerDiameterPoints = bulletDiameterInches * pixelsPerInch * imageScale
```

Where:
- `bulletDiameterInches`: User-selected caliber (e.g., 0.308 for .30 cal)
- `pixelsPerInch`: Calculated during calibration step
- `imageScale`: Current zoom/display scale of the image

### Implementation

**Step 3 (Mark Holes) now includes bullet diameter selector at the top:**

```
┌─────────────────────────────────────────────────────────────┐
│  ◀ Back          Mark Holes                        Next ▶   │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  Bullet Diameter: [.30 Cal (.308") ▼] or [Custom: 0.308"]   │
│                                                              │
│  ┌───────────────────────────────────────────────────────┐  │
│  │                                                        │  │
│  │              [Target Image]                            │  │
│  │                                                        │  │
│  │         ⊕ (POA - red crosshair)                       │  │
│  │                                                        │  │
│  │    ● (Hole 1 - green, scaled to .308")                │  │
│  │         ● (Hole 2 - green, scaled to .308")           │  │
│  │              ● (Hole 3 - green, scaled to .308")      │  │
│  │                                                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                              │
│  Tap to add holes. Long-press to set POA (Point of Aim).    │
│                                                              │
│  Holes: 3    [Undo Last]                                    │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

**HoleMarker.swift changes:**

```swift
struct HoleMarker: View {
    let position: CGPoint
    let number: Int
    let isSelected: Bool

    // NEW: Dynamic sizing based on caliber
    let diameterPoints: CGFloat  // Calculated from bullet diameter * PPI * scale

    var body: some View {
        ZStack {
            // Filled circle scaled to actual bullet size
            Circle()
                .fill(Color.green.opacity(0.3))
                .frame(width: diameterPoints, height: diameterPoints)

            // Stroke outline
            Circle()
                .stroke(Color.green, lineWidth: 2)
                .frame(width: diameterPoints, height: diameterPoints)

            // Number label (centered)
            Text("\(number)")
                .font(.system(size: max(10, diameterPoints * 0.4)))
                .foregroundColor(.white)
                .shadow(radius: 1)
        }
        .position(position)
    }
}
```

### Minimum Marker Size
To ensure markers remain visible and tappable, enforce minimum size:
```swift
let minMarkerSize: CGFloat = 20  // Minimum for touch target
let calculatedSize = bulletDiameter * ppi * scale
let actualSize = max(minMarkerSize, calculatedSize)
```

---

## Wizard Steps Detail

### Step 1: Capture Image

- Camera capture (primary action)
- Photo library selection (secondary)
- Supports both portrait and landscape images
- Stores original image locally

### Step 2: Calibration

- User places two points on a known reference distance
- User enters the reference distance (inches)
- System calculates `pixelsPerInch`
- Visual feedback: line drawn between calibration points with distance label

**Calibration Reference Options:**
- Grid square (1" for standard targets)
- Known target feature (e.g., 1" bullseye)
- Ruler placed in photo

### Step 3: Mark Holes

**NEW: Bullet diameter selector at top of view**

- Select from common calibers OR enter custom diameter
- Selected diameter immediately affects hole marker display size
- POA (Point of Aim): Long-press to place red crosshair
- Holes: Tap to place green circles (scaled to selected caliber)
- Undo: Remove last placed marker
- Clear: Remove all markers (with confirmation)

**Common Calibers (CommonBulletDiameter enum):**
| Name | Diameter |
|------|----------|
| .22 Cal | 0.224" |
| .243 Cal | 0.243" |
| 6.5mm | 0.264" |
| 7mm | 0.284" |
| .30 Cal | 0.308" |
| .338 Cal | 0.338" |
| .45 Cal | 0.452" |
| .50 Cal | 0.510" |

### Step 4: Metadata

- Distance (yards) - defaults from session context if available
- Bullet diameter - carried forward from Step 3, editable
- Notes (optional)

**Note:** Bullet diameter selection moved primarily to Step 3, but remains editable here for fine-tuning after seeing the marked image.

### Step 5: Review

Display calculated metrics:
- Extreme Spread (Center-to-Center and Edge-to-Edge)
- Mean Radius
- Horizontal/Vertical Spread
- CEP50
- Centroid offset from POA

Display annotated image preview:
- Original image with overlays
- Caliber-scaled hole circles
- POA crosshair
- Centroid marker (orange)
- Lines showing extreme spread, mean radius

Actions:
- Save (stores locally, queues for sync)
- Retake (go back to Step 1)
- Cancel (discard measurement)

---

## API Sync Behavior

### When Measurement is Saved

1. **Measurement data** saved to local `PendingGroupMeasurement`
2. **Images** (original + annotated) saved to local image cache
3. Entry added to sync queue

### Background Sync (when online)

1. **For pending sessions**: Measurement syncs when parent session syncs
2. **For existing synced sessions**: Measurement syncs immediately
   - POST to `/api/sessions/{sessionId}/groups/{groupId}/measurement`
   - Upload images to MinIO
   - Update local record as synced

### Conflict Resolution

If server already has a measurement for this group:
- Default: Replace with newer local measurement
- Future: Could show comparison and let user choose

---

## Migration Plan

### Phase 1: Consolidate Into Single Wizard

**Goal:** One codebase that handles all contexts (synced, pending, standalone).

**Approach:** Use the offline flow as the base (it already has local calculation), then add the good parts from the online flow.

1. **Create new unified ViewModel** (`GroupMeasurementViewModel.swift`):
   ```swift
   @MainActor
   class GroupMeasurementViewModel: ObservableObject {
       // Three initialization contexts
       enum Context {
           case synced(groupId: Int, groupEntry: GroupEntry)  // From synced session
           case pending(entry: PendingGroupEntry)              // From pending session
           case standalone(groupNumber: Int, distance: Int)    // Quick add
       }

       let context: Context

       // ... rest of properties (same as current offline VM)

       func save() async {
           // Calculate metrics locally (always)
           let metrics = try LocalGroupMetricsCalculator.calculate(...)

           switch context {
           case .synced(let groupId, _):
               // Try to sync immediately
               if NetworkMonitor.shared.isConnected {
                   try await syncToServer(groupId: groupId)
               } else {
                   queueForSync(groupId: groupId)
               }
           case .pending(let entry):
               // Save to pending entry
               saveToPendingEntry(entry)
           case .standalone:
               // Save as standalone measurement
               saveToLocalStorage()
           }
       }
   }
   ```

2. **Create unified flow view** (`GroupMeasurementFlow.swift`):
   - Same 5-step wizard structure
   - Works identically regardless of context
   - Pull in annotated image generation from online flow (it has caliber-scaled circles)

3. **Update callers** to use new unified flow:
   - `GroupEntryDetailView` → use `.synced` context
   - `PendingGroupEntryView` → use `.pending` context
   - Standalone entry point → use `.standalone` context

4. **Delete deprecated files:**
   - `OfflineGroupMeasurementFlow.swift`
   - `OfflineGroupMeasurementViewModel.swift`
   - Old `GroupMeasurementFlow.swift`
   - Old `GroupMeasurementViewModel.swift`
   - `HoleMarkingView.swift` (integrated)
   - `AdaptiveGroupMeasurementFlow.swift` (no longer needed)

### Phase 2: Enhanced Hole Marking (Optional Enhancement)

**Goal:** Make interactive hole markers scale to actual bullet size (like the annotated image already does).

1. Move bullet diameter selector to Step 3 (Mark Holes) - show it above the image
2. Update `HoleMarker.swift` to accept `diameterPoints` parameter
3. Calculate: `bulletDiameter * pixelsPerInch * imageScale`
4. Enforce minimum 20pt for touch targets
5. Real-time update when user changes caliber selection

### Phase 3: Testing Checklist

**Context Tests:**
- [ ] Standalone measurement saves to local storage
- [ ] Pending session measurement attaches to PendingGroupEntry
- [ ] Synced session measurement syncs when online
- [ ] Synced session measurement queues when offline

**Wizard Tests:**
- [ ] All 5 steps navigate correctly
- [ ] Calibration calculates accurate PPI
- [ ] Hole positions convert correctly to inches
- [ ] Metrics match expected values
- [ ] Annotated image generates with caliber-scaled circles

**Sync Tests:**
- [ ] Online → syncs immediately
- [ ] Offline → queues, syncs when connection returns
- [ ] Image upload works
- [ ] Existing measurement update works (PUT not POST)

---

## Files Affected

### Create (New Unified Files)
- `Features/GroupMeasurement/ViewModels/GroupMeasurementViewModel.swift` - Unified VM with Context enum
- `Features/GroupMeasurement/Views/GroupMeasurementFlow.swift` - Unified 5-step wizard

### Delete (Old Duplicate Code)
- `Features/GroupMeasurement/Views/OfflineGroupMeasurementFlow.swift`
- `Features/GroupMeasurement/ViewModels/OfflineGroupMeasurementViewModel.swift`
- `Features/GroupMeasurement/Views/HoleMarkingView.swift` (integrated into flow)
- `Features/GroupMeasurement/Views/AdaptiveGroupMeasurementFlow.swift` (no longer needed)

### Modify
- `HoleMarker.swift` - Add optional `diameterPoints` parameter for caliber scaling
- `GroupEntryDetailView.swift` - Update to use unified flow with `.synced` context
- `PendingGroupEntryView.swift` - Update to use unified flow with `.pending` context
- Any standalone entry points - Use `.standalone` context

### Keep Unchanged
- `LocalGroupMetricsCalculator.swift` - Already works great
- `POAMarker.swift` - No changes needed
- `CommonBulletDiameter` enum in `GroupMeasurement.swift`
- `PendingGroupMeasurement` in `PendingSession.swift`
- `GroupMeasurementService.swift` - Still used for syncing

---

## Success Criteria

1. **Single codebase**: One group measurement flow, not two
2. **Offline-first**: All measurement operations work without network
3. **Consistent UX**: Same experience regardless of connectivity
4. **Caliber-scaled markers**: Hole markers visually represent actual bullet size
5. **Reliable sync**: Measurements sync to server when connectivity available
6. **Backward compatible**: Existing pending measurements still work

---

## Open Questions

1. **Should we show a "Synced" indicator on measurements?**
   - Option A: Show sync status badge on measurement cards
   - Option B: Only show in detail view
   - Option C: Don't show - users don't care about sync status

2. **What if calibration seems wrong?**
   - Option A: Warn if calculated PPI seems unreasonable
   - Option B: Allow "re-calibrate" at any step
   - Option C: Trust the user

3. **Support for multiple reference objects?**
   - Current: Single reference distance
   - Future: Multiple references for better accuracy?

---

## Implementation Progress

### Completed (2025-01-03)

- [x] Created unified `GroupMeasurementViewModel.swift` with Context enum
- [x] Created unified `GroupMeasurementFlow.swift` with 5-step wizard
- [x] Updated `HoleMarker.swift` with optional `diameterPoints` for caliber scaling
- [x] Updated `SessionDetailView.swift` to use unified flow
- [x] Updated `PendingDataEntryForms.swift` to use unified flow
- [x] Deleted deprecated files: `OfflineGroupMeasurementFlow.swift`, `OfflineGroupMeasurementViewModel.swift`, `HoleMarkingView.swift`, `AdaptiveGroupMeasurementFlow.swift`, old step view files
- [x] Created `GroupMeasurementHelpers.swift` for shared components (InstructionBanner, TipRow, CGPoint extension)
- [x] Build succeeded

### Testing Results (2025-01-03)

**Online Measurement:** Working correctly

**Offline Measurement Issues Found:**

---

## Phase 4: Post-Testing Fixes Required

### Priority 1: Offline Session Creation UX Fix ✅ COMPLETED

**Issue:** After creating an offline session, the "Session Saved Locally" dialog has confusing options:
- "Done" button takes user to home screen (useless, causes confusion)
- "View Session" button is the useful action

**Fix Applied:**
- Changed "Done" button to "Close" with `role: .cancel` to clearly indicate it's the secondary action
- "View Session" remains as primary action

**Files modified:**
- `SessionCreateView.swift` - Changed alert button from "Done" to "Close" with cancel role

---

### Priority 2: Pending Sessions Not Showing in Recent Sessions

**Issue:** After creating a pending session and hitting "Done", the pending session doesn't appear in the "Recent Sessions" tab.

**Impact:** Low priority but adds to user confusion

**Fix Required:**
- Investigate why pending sessions aren't included in Recent Sessions query
- May need to modify `SessionsViewModel` or the Recent Sessions fetch logic

---

### Priority 3 & 4: Unified Flow - Use QuickMeasureGroupFlow for All Sessions ✅ COMPLETED

**Issue:** The offline measurement wizard (GroupMeasurementFlow) had:
- Different step order than online (QuickMeasureGroupFlow)
- Different UI (no prominent Quick Measure button)
- Missing widget overlay/export feature

**Solution Applied:** Instead of fixing GroupMeasurementFlow, we enhanced QuickMeasureGroupFlow to support BOTH online and offline sessions:

1. **QuickMeasureGroupViewModel** now supports both session types:
   - Added `SessionContext` enum with `.online(sessionId:)` and `.offline(pendingSessionId:)` cases
   - Added separate initializers for online and offline modes
   - `calculateAndSave()` routes to appropriate save method based on context
   - Offline save calculates metrics locally and queues to `OfflineSessionQueue`
   - Added `savedOffline` flag for UI feedback

2. **QuickMeasureGroupFlow** now has two initializers:
   - `init(sessionId:...)` for online sessions (existing)
   - `init(pendingSessionId:...)` for offline/pending sessions (new)

3. **PendingSessionDetailView** updated to:
   - Show prominent "Quick Measure" button matching online session UI
   - Use `QuickMeasureGroupFlow` with offline initializer
   - Show menu with "Quick Measure" and "Manual Entry" options in header

4. **GroupMeasurement model** updated:
   - Added `init(localMetrics:...)` for creating display-only measurements from local calculations
   - Added memberwise initializer for previews/tests

5. **QuickCaptureReviewView** shows offline indicator when saved locally

**Files modified:**
- `QuickMeasureGroupViewModel.swift` - Added offline support
- `QuickMeasureGroupFlow.swift` - Added offline initializer and offline indicator
- `PendingSessionDetailView.swift` - Added Quick Measure button and flow
- `GroupMeasurement.swift` - Added local and memberwise initializers

---

### Priority 5: Overlay/Export in Unified Flow ✅ COMPLETED

**Issue:** Online flow has a "Widget Overlay" step allowing users to add stats overlay to image for sharing.

**Solution:** By using `QuickMeasureGroupFlow` for offline sessions (see Priority 3 & 4), the Widget Overlay step is now available for all sessions - both online and offline.

**Additional enhancement:**
- `QuickMeasureGroupViewModel.updateAnnotatedImageWithOverlay()` now handles offline mode by updating the image in `OfflineSessionQueue` instead of uploading to server

---

### Priority 6: Online Session Goes Offline Mid-Use (Low Priority)

**Issue:** If user starts with online session then loses connectivity, behavior is unclear.

**Current behavior:** Unclear/problematic

**Expected behavior:**
- Detect connectivity change
- Queue measurement for sync instead of failing
- Show appropriate feedback to user

**Fix Required:**
- Add connectivity monitoring during save operation
- Graceful fallback to queue-for-sync behavior
- User feedback about queued state

---

### Priority 7: Improved Image Pan/Zoom Controls (UX Enhancement) ✅ COMPLETED

**Issue:** Current zoom behavior on hole marking and calibration steps was limited:
- Zoom only centered on the middle of the image
- Could not pan around the image after zooming
- Made it difficult to accurately mark holes in corners/edges of large images

**Solution Applied:** Replaced SwiftUI gesture-based zoom with UIKit `UIScrollView` wrapper for native iOS zoom/pan behavior.

**Implementation:**
- Created `ZoomableImageView` component using `UIViewRepresentable` with `UIScrollView`
- `UIScrollView` provides true focal-point pinch-to-zoom (zooms toward pinch location)
- Single-finger drag to pan around zoomed image
- Native iOS bounce effects at boundaries
- Double-tap to zoom in (2.5x) at tap location, or zoom out if already zoomed
- Taps converted correctly to image coordinates regardless of zoom level
- Overlay (markers) scales with image during zoom

**Features:**
- True focal-point zoom - zooms into where you pinch
- Single-finger pan - drag to move around zoomed image
- Bounds checking - elastic bounce at edges
- Double-tap zoom toggle - tap twice to zoom in/out
- Consistent marker placement - taps work correctly at any zoom level

**Files modified:**
- `ZoomableImageView.swift` - Complete rewrite using UIScrollView
- `QuickMeasureGroupFlow.swift` - `QuickCaptureCalibrationStepView` and `QuickCaptureHoleMarkingView` now use `ZoomableImageView`

---

## Related Files Reference

| File | Purpose |
|------|---------|
| `LocalGroupMetricsCalculator.swift` | Calculates all group metrics locally |
| `PendingSession.swift` | Contains `PendingGroupEntry`, `PendingGroupMeasurement` |
| `GroupMeasurement.swift` | Contains `CommonBulletDiameter` enum, `GroupMeasurement` model |
| `HoleMarker.swift` | Green circle component for hole markers |
| `POAMarker.swift` | Red crosshair component for POA |
| `OfflineSessionQueue.swift` | Manages pending session queue and sync |
| `GroupMeasurementHelpers.swift` | Shared components (InstructionBanner, TipRow, CGPoint extension) |
| `QuickMeasureGroupFlow.swift` | Reference for Quick Measure pattern and Widget Overlay |
| `WidgetOverlayStepView.swift` | Reference for overlay generation |
