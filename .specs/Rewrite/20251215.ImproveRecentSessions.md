# Improve Recent Sessions Table

**Date**: December 15, 2025
**Status**: Proposed
**Affects**: TrueDope v2 Frontend (Home.tsx, AnalyticsDashboard.tsx)

## Problem Statement

The "Recent Sessions" table that appears on both the Dashboard (Home) and Analytics Dashboard pages shows minimal data that doesn't give users meaningful insight at a glance. Looking at the screenshots:

**Current columns:**
- Date (only)
- Rifle (name only, no caliber)
- Location
- DOPE (count badge or dash)
- Chrono (count badge or dash)
- Groups (count badge or dash)

**Issues:**
1. **Missing Rifle context**: No indication of caliber (is this a .308 session or a .22LR session?)
2. **Empty data columns**: Many sessions show "-" for DOPE/Chrono/Groups, wasting horizontal space with no value
3. **No ammunition info**: The ammunition used is often the most important context for a session
4. **No summary data**: The backend already returns useful data (averageVelocity, standardDeviation, etc.) but we don't display it
5. **No rounds fired**: Important metric that's available but not shown
6. **No weather/conditions**: Temperature could be useful context
7. **Count badges lack context**: "3" DOPE entries means nothing - what distances?

## Available Data (Already in SessionListDto)

The backend already returns rich data that we're ignoring:

```typescript
interface SessionListDto {
  // Currently displayed
  sessionDate: string;
  rifleName: string;
  locationName: string | null;
  dopeCount: number;
  chronoCount: number;
  groupCount: number;

  // NOT displayed but available
  sessionTime: string | null;        // Could show time if available
  rifle: { id, name, caliber };      // Caliber available!
  temperature: number | null;        // Weather context
  roundsFired: number | null;        // Key metric
  ammunitionName: string | null;     // What ammo was used
  averageVelocity: number | null;    // Chrono summary
  standardDeviation: number | null;  // Chrono quality metric
  extremeSpread: number | null;      // Chrono quality metric
  imageCount: number;                // Has photos?
}
```

## Proposed Solution

### Option A: Enhanced Single Table (Recommended)

Redesign the table to show more meaningful data in the same space:

| Date | Rifle | Ammo | Data | Summary |
|------|-------|------|------|---------|
| 11/1/2025 | URGI (.223) | AAC 77gr OTM | DOPE (3) / Chrono / Groups | Avg: 2,745 fps, SD: 12 |
| 10/19/2025 | M24 (.308) | FGMM 175gr | DOPE (5) | 100-500 yds |
| 10/18/2025 | URGI (.223) | - | Groups (2) | 0.8 MOA best |

**Column Changes:**
1. **Date**: Add time if available (e.g., "11/1/2025 2:30 PM")
2. **Rifle**: Show caliber in parentheses: "URGI (.223)"
3. **Ammo**: New column - show ammunition name (truncated if needed)
4. **Data**: Consolidated badges - only show what exists, skip the dashes
5. **Summary**: Context-aware summary based on what data type dominates:
   - If chrono: "Avg: X fps, SD: Y"
   - If DOPE: Distance range "100-500 yds"
   - If groups: "Best: X MOA" or "X shots @ Y yds"

### Option B: Card Layout for Mobile-First

Replace the table with session cards that show richer information:

```
┌─────────────────────────────────────────────────────────┐
│ 11/1/2025 2:30 PM                              URGI    │
│ Rustic Range Slaton                            .223    │
│─────────────────────────────────────────────────────────│
│ AAC 77gr OTM                        68°F  ☀️           │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐                    │
│ │ DOPE: 3 │ │ Chrono  │ │ Groups  │     42 rounds     │
│ │100-500y │ │2745 fps │ │ 0.8 MOA │                    │
│ └─────────┘ └─────────┘ └─────────┘                    │
└─────────────────────────────────────────────────────────┘
```

### Option C: Hybrid - Expandable Rows

Keep the compact table but add expandable rows that reveal more detail on click:

**Collapsed (current-ish):**
| Date | Rifle | Location | Data |
|------|-------|----------|------|
| ▶ 11/1/2025 | URGI (.223) | Rustic Range | DOPE (3), Chrono, Groups |

**Expanded:**
| Date | Rifle | Location | Data |
|------|-------|----------|------|
| ▼ 11/1/2025 | URGI (.223) | Rustic Range | DOPE (3), Chrono, Groups |
| └─ AAC 77gr OTM • 42 rounds • Avg: 2745 fps, SD: 12 • Groups: 0.8-1.2 MOA |

## Recommended Implementation

Taking inspiration from v1's "Recent Sessions" table which had a clean layout:
- **Type badge** - Single badge showing session type (Velocity, DOPE, Groups)
- **Details column** - Contextual summary like "10rds @ 2880fps (SD: 13.3)"
- **Rifle as link** - Clickable to rifle details
- **View button** - Explicit action

### New Column Structure

| Column | Content | Example |
|--------|---------|---------|
| Date | Session date (+ time if available) | Nov 01, 2025 |
| Rifle | Rifle name as link + caliber | URGI (.223) |
| Type | Badge(s) for data types present | `DOPE` `Velocity` |
| Details | Context-aware summary | 10rds @ 2880fps (SD: 13.3) |
| Actions | View button | View → |

### Phase 1: Frontend Changes

#### 1. Update Table Headers

```tsx
<tr>
  <th>Date</th>
  <th>Rifle</th>
  <th>Type</th>
  <th>Details</th>
  <th>Actions</th>
</tr>
```

#### 2. Date Column - Add Time if Available

```tsx
<td>
  {new Date(session.sessionDate).toLocaleDateString('en-US', {
    month: 'short',
    day: '2-digit',
    year: 'numeric'
  })}
  {session.sessionTime && (
    <span className="text-gray-500 ml-1 text-xs">
      {formatTime(session.sessionTime)}
    </span>
  )}
</td>
```

#### 3. Rifle Column - Link with Caliber

```tsx
<td>
  <Link to={`/rifles/${session.rifle.id}`} className="text-blue-600 hover:underline">
    {session.rifleName}
  </Link>
  <span className="text-gray-500 text-xs ml-1">({session.rifle.caliber})</span>
</td>
```

#### 4. Type Column - Consolidated Badges

Only show badges for data that exists (no more dashes):
```tsx
<td>
  <div className="flex flex-wrap gap-1">
    {session.dopeCount > 0 && <DopeBadge />}
    {session.hasChronoData && <VelocityBadge />}
    {session.groupCount > 0 && <GroupBadge />}
  </div>
</td>
```

#### 5. Details Column - Context-Aware Summary

Build a smart summary based on what data exists:
```tsx
<td>
  {formatSessionDetails(session)}
</td>

// Helper function
function formatSessionDetails(session: SessionListDto): string {
  const parts: string[] = [];

  // Chrono data takes priority for details
  if (session.hasChronoData && session.averageVelocity) {
    const rounds = session.velocityReadingCount || session.chronoCount;
    let detail = `${rounds}rds @ ${Math.round(session.averageVelocity)}fps`;
    if (session.standardDeviation) {
      detail += ` (SD: ${session.standardDeviation.toFixed(1)})`;
    }
    parts.push(detail);
  }

  // DOPE summary
  if (session.dopeCount > 0) {
    parts.push(`${session.dopeCount} DOPE entries`);
  }

  // Group summary
  if (session.groupCount > 0) {
    parts.push(`${session.groupCount} groups`);
  }

  return parts.join(' • ') || '-';
}
```

#### 6. Actions Column - View Button

```tsx
<td>
  <Button variant="outline" size="sm" onClick={() => navigate(`/sessions/${session.id}`)}>
    View
  </Button>
</td>
```

### Phase 2: Backend Changes for Richer Details

Add computed fields to `SessionListDto` for better summaries:

#### Backend DTO Changes

**SessionDtos.cs:**
```csharp
public class SessionListDto
{
    // ... existing fields ...

    // New fields for enhanced details
    public int? MinDopeDistance { get; set; }
    public int? MaxDopeDistance { get; set; }
    public decimal? BestGroupMoa { get; set; }
    public int? BestGroupDistance { get; set; }
}
```

#### Backend Service Changes

**SessionService.cs** - Update projection:
```csharp
MinDopeDistance = s.DopeEntries.Any() ? s.DopeEntries.Min(d => d.Distance) : null,
MaxDopeDistance = s.DopeEntries.Any() ? s.DopeEntries.Max(d => d.Distance) : null,
BestGroupMoa = s.GroupEntries.Any() ? s.GroupEntries.Min(g => g.GroupSizeMoa) : null,
BestGroupDistance = s.GroupEntries.Any()
    ? s.GroupEntries.OrderBy(g => g.GroupSizeMoa).First().Distance
    : null,
```

#### Enhanced Frontend Details

With the new backend data, improve the details:
```tsx
function formatSessionDetails(session: SessionListDto): string {
  const parts: string[] = [];

  // Chrono: "10rds @ 2880fps (SD: 13.3)"
  if (session.hasChronoData && session.averageVelocity) {
    const rounds = session.velocityReadingCount || session.chronoCount;
    let detail = `${rounds}rds @ ${Math.round(session.averageVelocity)}fps`;
    if (session.standardDeviation) {
      detail += ` (SD: ${session.standardDeviation.toFixed(1)})`;
    }
    parts.push(detail);
  }

  // DOPE: "5 DOPE (100-500yds)" or "DOPE: 100-500yds"
  if (session.dopeCount > 0) {
    if (session.minDopeDistance && session.maxDopeDistance) {
      if (session.minDopeDistance === session.maxDopeDistance) {
        parts.push(`DOPE @ ${session.minDopeDistance}yds`);
      } else {
        parts.push(`DOPE: ${session.minDopeDistance}-${session.maxDopeDistance}yds`);
      }
    } else {
      parts.push(`${session.dopeCount} DOPE entries`);
    }
  }

  // Groups: "Best: 0.8 MOA @ 100yds"
  if (session.groupCount > 0) {
    if (session.bestGroupMoa) {
      let detail = `Best: ${session.bestGroupMoa.toFixed(2)} MOA`;
      if (session.bestGroupDistance) {
        detail += ` @ ${session.bestGroupDistance}yds`;
      }
      parts.push(detail);
    } else {
      parts.push(`${session.groupCount} groups`);
    }
  }

  return parts.join(' • ') || '-';
}
```

## Files to Modify

### Phase 1: Frontend Only

| File | Changes |
|------|---------|
| `frontend/src/pages/Home.tsx` | Update table structure, add formatSessionDetails helper |
| `frontend/src/pages/analytics/AnalyticsDashboard.tsx` | Same changes as Home.tsx |
| `frontend/src/utils/formatters.ts` | Add formatTime, formatSessionDetails functions |

### Phase 2: Backend + Frontend

| File | Changes |
|------|---------|
| `backend/src/TrueDope.Api/DTOs/Sessions/SessionDtos.cs` | Add MinDopeDistance, MaxDopeDistance, BestGroupMoa, BestGroupDistance |
| `backend/src/TrueDope.Api/Services/SessionService.cs` | Calculate new fields in LINQ projection |
| `frontend/src/types/sessions.ts` | Add new fields to SessionListDto interface |
| `frontend/src/pages/Home.tsx` | Update formatSessionDetails to use new fields |
| `frontend/src/pages/analytics/AnalyticsDashboard.tsx` | Same updates |

## Example Mockup

**Before (Current v2):**
```
┌──────────────┬────────┬─────────────────────┬──────┬────────┬────────┐
│ Date         │ Rifle  │ Location            │ DOPE │ Chrono │ Groups │
├──────────────┼────────┼─────────────────────┼──────┼────────┼────────┤
│ 11/1/2025    │        │ Rustic Range Slaton │  -   │   -    │   -    │
│ 11/1/2025    │        │ Rustic Range Slaton │  -   │   -    │   -    │
│ 10/19/2025   │        │ Rustic Range Slaton │  -   │   -    │   -    │
└──────────────┴────────┴─────────────────────┴──────┴────────┴────────┘
```

**After (Proposed - inspired by v1):**
```
┌───────────────┬──────────────┬──────────────────┬────────────────────────────────┬─────────┐
│ Date          │ Rifle        │ Type             │ Details                        │ Actions │
├───────────────┼──────────────┼──────────────────┼────────────────────────────────┼─────────┤
│ Nov 01, 2025  │ URGI (.223)  │ [Velocity]       │ 10rds @ 2880fps (SD: 13.3)     │ [View]  │
│ Nov 01, 2025  │ URGI (.223)  │ [Velocity]       │ 10rds @ 2873fps (SD: 15.5)     │ [View]  │
│ Oct 19, 2025  │ M24 (.308)   │ [DOPE] [Groups]  │ DOPE: 100-500yds • Best: 0.8MOA│ [View]  │
│ Oct 15, 2025  │ URGI (.223)  │ [DOPE]           │ DOPE: 100-300yds               │ [View]  │
└───────────────┴──────────────┴──────────────────┴────────────────────────────────┴─────────┘
```

## Testing Checklist

### Phase 1
- [ ] Date column shows formatted date (e.g., "Nov 01, 2025")
- [ ] Time shows next to date when sessionTime is available
- [ ] Rifle name displays as clickable link to rifle detail page
- [ ] Rifle caliber displays in parentheses after name
- [ ] Type column shows only badges for data that exists (no dashes)
- [ ] Details column shows chrono summary: "10rds @ 2880fps (SD: 13.3)"
- [ ] Details column shows DOPE count when no chrono data
- [ ] Details column shows group count when no chrono/DOPE data
- [ ] View button navigates to session detail
- [ ] Row click still navigates to session detail
- [ ] Table renders correctly on both Home and Analytics pages
- [ ] Empty state still displays correctly when no sessions

### Phase 2
- [ ] Backend returns minDopeDistance and maxDopeDistance
- [ ] Backend returns bestGroupMoa and bestGroupDistance
- [ ] Details shows DOPE distance range: "DOPE: 100-500yds"
- [ ] Details shows single distance for same min/max: "DOPE @ 100yds"
- [ ] Details shows best group: "Best: 0.8 MOA @ 100yds"
- [ ] Multiple data types combine with bullet separator: "10rds @ 2880fps • DOPE: 100-300yds"

## Future Enhancements (Out of Scope)

- Add quick filters inline (filter by rifle, by data type)
- Add sorting controls to table headers
- Differentiate Analytics page table from Home page (more detail)
- Inline notes preview on hover
- Ammunition name column (available in DTO but not displayed for space)
- Temperature/conditions column
