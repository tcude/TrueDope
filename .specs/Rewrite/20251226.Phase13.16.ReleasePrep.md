# Phase 13.16: Release Preparation

**Created**: December 26, 2024
**Status**: In Progress
**Reference**: [20251217.Phase13.iOSOverhaul.md](./20251217.Phase13.iOSOverhaul.md)
**Prerequisites**: Apple Developer Account ($99 - completed)

---

## Overview

This phase prepares the TrueDope iOS app for TestFlight and App Store release. The app is functionally complete from Phase 13.1-13.14 and needs release configuration, assets, metadata, and testing on physical devices.

**Current State:**
- Bundle ID: `io.truedope.TrueDope-iOS`
- Version: 1.0 (Build 1)
- Deployment Target: iOS 17.0 (updated from 18.0)
- Code Signing: Automatic
- App Icon: Configuration exists, **images missing**
- Info.plist: Auto-generated with permissions configured
- Entitlements: None configured

---

## Subphases

### Phase 13.16.1: Xcode Project Configuration ✅ COMPLETED

**Goal**: Ensure all project settings are correct for App Store submission.

#### Tasks

- [x] **Update deployment target**
  - Updated: iOS 18.0 → iOS 17.0 for broader device reach
  - Rationale: iOS 17+ supports `@Observable` macro; iOS 17 captures more users while maintaining modern SwiftUI features
  - Also updated macOS deployment target: 15.6 → 14.0
  - Removed visionOS/macOS from supported platforms (focused on iPhone/iPad only)

- [x] **Configure App Category**
  - To be configured in App Store Connect (Phase 13.16.3)
  - Primary: Sports
  - Secondary: Utilities

- [x] **Set Marketing Version**
  - Confirmed: 1.0 (Build 1)
  - Correct for initial release

- [x] **Configure Info.plist permissions** (via Build Settings)
  - ✅ `NSCameraUsageDescription` - "TrueDope needs camera access to take photos of rifle setups and shooting targets."
  - ✅ `NSPhotoLibraryUsageDescription` - "TrueDope needs photo library access to attach existing photos to your shooting records."
  - ✅ `NSLocationWhenInUseUsageDescription` - "TrueDope needs your location to record shooting locations and fetch accurate weather data."

- [x] **Review Build Settings**
  - ✅ `SWIFT_OPTIMIZATION_LEVEL` = `-O` for Release (whole module optimization enabled)
  - ✅ `DEBUG_INFORMATION_FORMAT` = `dwarf-with-dsym` for Release (crash symbolication ready)
  - ✅ Bitcode disabled (deprecated)

- [x] **Configure App Transport Security**
  - ✅ Production URL: `https://truedope.io/api` (HTTPS)
  - ✅ Development URL: `http://localhost:8080/api` (HTTP allowed for localhost)
  - No ATS exceptions needed

- [x] **Verify Build**
  - ✅ Release build succeeded with iOS 17.0 target
  - Swift 6 warnings present (non-blocking, for future migration)

---

### Phase 13.16.2: App Icon Creation ✅ COMPLETED

**Goal**: Create professional app icons that represent TrueDope's precision shooting focus.

#### Design

Custom SVG icon created at `truedope-icon.svg` featuring:
- Dark navy background (#1a1a2e)
- Rifle scope with outer ring and inner dark circle
- Simple crosshair design in light gray
- Ballistic trajectory curve with data points (red/coral gradient)
- Professional, clean aesthetic that conveys precision shooting + data analytics

#### Tasks

- [x] **Design app icon** (1024x1024 base)
  - Created `truedope-icon.svg` as vector source
  - Converted to 1024x1024 PNG using `qlmanage`
  - Design: Scope reticle with ballistic drop curve and data points

- [x] **Export and add to Xcode**
  - Added `AppIcon.png` (1024x1024) to `Assets.xcassets/AppIcon.appiconset/`
  - Updated `Contents.json` with iOS-only universal icon
  - Xcode generates all required sizes: 60x60@2x (iPhone), 76x76@2x (iPad), etc.

- [x] **Verify icon in build**
  - Release build succeeded
  - Icon properly compiled and emplaced in app bundle

- [ ] **Dark mode variant** (deferred)
  - Icon already uses dark background, works well in both modes

- [ ] **Tinted variant** (deferred)
  - Can be added later if iOS tinting becomes important

---

### Phase 13.16.3: Apple Developer Portal Setup

**Goal**: Configure app in App Store Connect and set up certificates/profiles.

#### Prerequisites
- Apple Developer account (completed)
- Access to App Store Connect

#### Tasks

- [ ] **Create App ID in Developer Portal**
  - Bundle ID: `io.truedope.TrueDope-iOS`
  - Capabilities: None special needed (no push notifications, no HealthKit, etc.)
  - If using Sign in with Apple later, enable that capability

- [ ] **Configure Automatic Signing in Xcode**
  - Team: Select your Apple Developer team
  - Automatic signing should handle certificates and profiles
  - Verify "Automatically manage signing" is checked for both Debug and Release

- [ ] **Create App in App Store Connect**
  - Name: "TrueDope"
  - Primary Language: English (U.S.)
  - Bundle ID: Select `io.truedope.TrueDope-iOS`
  - SKU: `truedope-ios-v1` (or similar unique identifier)

- [ ] **Configure App Information**
  - Category: Sports (primary), Utilities (secondary)
  - Content Rights: Does not contain third-party content
  - Age Rating: Complete questionnaire (likely 4+ or 12+ due to firearm-related content - follow Apple's guidance)

---

### Phase 13.16.4: App Store Metadata

**Goal**: Prepare all text and media required for App Store listing.

#### App Store Text Content

- [ ] **App Name** (30 characters max)
  - "TrueDope - Ballistic Logger"
  - Or: "TrueDope"

- [ ] **Subtitle** (30 characters max)
  - "Precision Shooting Data"
  - Or: "Track DOPE & Ballistics"

- [ ] **Promotional Text** (170 characters, can be updated anytime)
  - "Log your DOPE data, chrono readings, and group sizes. Track every shot to become a more consistent long-range shooter."

- [ ] **Description** (4000 characters max)
```
TrueDope is the precision shooter's companion for logging and analyzing ballistic data.

TRACK YOUR DOPE
Record elevation and windage holds at various distances. See your data in MOA or MIL based on your preference. Build a comprehensive DOPE card for each rifle/ammo combination.

CHRONOGRAPH SESSIONS
Log velocity readings from your chronograph. TrueDope automatically calculates average velocity, standard deviation, extreme spread, and more. Track how your loads perform over time.

GROUP ANALYSIS
Record group sizes and mean radius. Attach photos of your targets. Compare performance across different ammunition and lots.

MANAGE YOUR GEAR
Keep detailed records of your rifles including barrel specs, optics, and zero data. Track your ammunition inventory with lot-specific data for handloaders and precision shooters.

WEATHER & CONDITIONS
Automatically fetch weather data for your range sessions. Track temperature, humidity, wind, pressure, and density altitude to understand how conditions affect your performance.

POWERFUL ANALYTICS
- DOPE charts showing elevation across distances
- Velocity trends over time
- Ammunition comparison charts
- Lot-to-lot consistency analysis
- Cost tracking and analysis

DESIGNED FOR SHOOTERS
Built by precision shooters, for precision shooters. TrueDope uses the terminology and workflows you expect. No bloat, no unnecessary features - just the data you need to shoot better.

CLOUD SYNC
Your data syncs securely to the cloud. Access your DOPE cards and session history from any device.

Requirements:
- iOS 17.0 or later
- TrueDope account (free to create)
```

- [ ] **Keywords** (100 characters, comma-separated)
  - "DOPE,ballistics,shooting,rifle,long range,chronograph,reloading,precision,scope,ammo,velocity"

- [ ] **Support URL**
  - https://truedope.io/support (or appropriate URL)
  - Or GitHub issues: https://github.com/[repo]/issues

- [ ] **Privacy Policy URL** (required)
  - https://truedope.io/privacy
  - Must create this page if it doesn't exist

- [ ] **Copyright**
  - "2024 TrueDope" (or your name/company)

#### Screenshots

Required sizes (for iPhone):
- 6.7" (iPhone 15 Pro Max): 1290 x 2796 px
- 6.5" (iPhone 14 Plus): 1284 x 2778 px
- 5.5" (iPhone 8 Plus): 1242 x 2208 px

**Screenshot set (5-10 screens recommended):**

- [ ] **Screenshot 1: Dashboard/Home**
  - Caption: "Your shooting data at a glance"

- [ ] **Screenshot 2: Session List**
  - Caption: "Track every range session"

- [ ] **Screenshot 3: Session Detail with DOPE**
  - Caption: "Record elevation and windage holds"

- [ ] **Screenshot 4: Chrono Data**
  - Caption: "Analyze velocity and consistency"

- [ ] **Screenshot 5: DOPE Chart (Analytics)**
  - Caption: "Visualize your ballistic data"

- [ ] **Screenshot 6: Rifle Management**
  - Caption: "Organize your gear"

- [ ] **Screenshot 7: Ammunition/Lots**
  - Caption: "Track ammunition by lot"

- [ ] **Screenshot 8: Settings/Preferences**
  - Caption: "Customize units and display"

**Tasks:**
- [ ] Take screenshots on iPhone 15 Pro Max simulator (or device)
- [ ] Optionally add device frames and marketing text
- [ ] Export at required resolutions

#### App Preview Video (Optional)

- [ ] **Create 15-30 second preview video** (optional but recommended)
  - Show key workflows: create session, add DOPE, view analytics
  - No voiceover required, can use captions
  - Resolution: Same as screenshots

---

### Phase 13.16.5: Privacy & Legal

**Goal**: Create required legal documents and configure privacy settings.

#### Tasks

- [ ] **Create Privacy Policy page**
  - Host at https://truedope.io/privacy
  - Must describe:
    - What data is collected (account info, shooting data, location, images)
    - How data is used (app functionality, no selling to third parties)
    - Data retention policy
    - User rights (data export, deletion)
    - Contact information

- [ ] **Create Terms of Service page** (recommended)
  - Host at https://truedope.io/terms

- [ ] **App Store Privacy Questionnaire**
  - Data types collected:
    - Contact Info: Email (for account)
    - User Content: Photos (target images)
    - Location: Coarse location (for weather)
    - Identifiers: User ID
    - Usage Data: Product interaction
  - Data linked to user: Yes (account-based)
  - Data used for tracking: No

- [ ] **Configure Data Safety in App Store Connect**
  - Complete the App Privacy section
  - Answer all questions about data collection and usage

---

### Phase 13.16.6: Production Environment Verification

**Goal**: Ensure the production backend is ready and the app points to it correctly.

#### Tasks

- [ ] **Verify production API is deployed and accessible**
  - URL: https://api.truedope.io (or your production URL)
  - Test health endpoint: `GET /api/health`

- [ ] **Update Config.swift production URL**
  - Verify `productionBaseURL` is correct
  - Ensure automatic environment detection works

- [ ] **Test production authentication**
  - Create test account on production
  - Verify login/register works
  - Verify token refresh works

- [ ] **Test all API endpoints against production**
  - CRUD operations for rifles, ammo, sessions
  - Image upload/download
  - Analytics endpoints
  - Weather/geocoding APIs

- [ ] **Verify HTTPS certificate**
  - Ensure production API has valid SSL certificate
  - No certificate pinning needed for v1 (consider for future)

---

### Phase 13.16.7: Archive and Physical Device Testing

**Goal**: Build release archive and test on physical devices.

#### Tasks

- [ ] **Clean build folder**
  - Xcode: Product > Clean Build Folder (Cmd+Shift+K)

- [ ] **Archive the app**
  - Select "Any iOS Device (arm64)" as destination
  - Product > Archive
  - Verify archive completes without errors

- [ ] **Validate archive**
  - In Organizer, select archive
  - Click "Validate App"
  - Fix any validation errors

- [ ] **Test on physical iPhone**
  - Install via Xcode to personal device
  - Test all critical flows:
    - Login/register
    - Create rifle
    - Create ammunition
    - Create session with DOPE, chrono, groups
    - View analytics
    - Change preferences
    - Logout

- [ ] **Test on multiple device sizes** (if available)
  - iPhone SE (small screen)
  - iPhone 15 Pro (standard)
  - iPhone 15 Pro Max (large screen)

- [ ] **Test offline behavior**
  - Enable airplane mode
  - Verify offline banner appears
  - Verify appropriate error messages
  - Verify app recovers when connection restored

- [ ] **Test in different conditions**
  - Dark mode
  - Light mode
  - Dynamic Type (large text)
  - Low battery mode

---

### Phase 13.16.8: TestFlight Submission

**Goal**: Upload build to TestFlight for beta testing.

#### Tasks

- [ ] **Increment build number** (if not first upload)
  - Build number must be unique for each upload
  - Marketing version can stay at 1.0

- [ ] **Upload to App Store Connect**
  - In Organizer, select validated archive
  - Click "Distribute App"
  - Select "App Store Connect"
  - Select "Upload"
  - Wait for upload and processing (can take 15-30 minutes)

- [ ] **Complete TestFlight Information**
  - In App Store Connect > TestFlight
  - Add test information:
    - What to test
    - Test account credentials (if needed)
    - Beta App Review notes

- [ ] **Submit for Beta App Review**
  - External testers require Beta App Review
  - Review typically takes 24-48 hours

- [ ] **Add Internal Testers**
  - Add yourself and any team members
  - Internal testers don't require review

- [ ] **Add External Testers** (optional)
  - Create tester groups
  - Add email addresses
  - External testers receive TestFlight invite

---

### Phase 13.16.9: Beta Testing Round

**Goal**: Gather feedback and fix issues before App Store release.

#### Tasks

- [ ] **Distribute to internal testers**
  - Verify TestFlight install works
  - Gather initial feedback

- [ ] **Create feedback collection mechanism**
  - TestFlight built-in feedback
  - Or: Email/form for detailed feedback
  - Or: GitHub issues

- [ ] **Monitor for crashes**
  - Check App Store Connect > TestFlight > Crashes
  - Review crash logs and symbolicate if needed

- [ ] **Address critical bugs**
  - Fix any blocking issues
  - Upload new build if needed
  - Increment build number for each upload

- [ ] **Expand to external testers** (if desired)
  - After Beta App Review approval
  - Invite external beta testers
  - Set expiration date for beta

- [ ] **Document known issues**
  - Create list of known issues for release notes
  - Prioritize fixes for post-launch updates

---

### Phase 13.16.10: App Store Submission (Future)

**Goal**: Submit for App Store review when ready for public release.

> Note: This subphase is included for completeness but may be executed after additional beta testing.

#### Tasks

- [ ] **Final version bump** (if needed)
  - Marketing version: 1.0 (or 1.0.0)
  - Build number: Increment from TestFlight builds

- [ ] **Complete App Store listing**
  - All metadata entered
  - All screenshots uploaded
  - Privacy questionnaire complete

- [ ] **Submit for App Review**
  - In App Store Connect > App Store tab
  - Select build from TestFlight
  - Add App Review notes if needed
  - Submit for review

- [ ] **Monitor review status**
  - Typical review time: 24-48 hours
  - Respond to any reviewer questions

- [ ] **Handle rejection** (if applicable)
  - Review rejection reason
  - Address issues
  - Resubmit

- [ ] **Release to App Store**
  - Option: Manual release (you control when it goes live)
  - Option: Automatic release after approval

---

## Timeline Checklist

| Subphase | Description | Est. Effort |
|----------|-------------|-------------|
| 13.16.1 | Xcode Project Configuration | 1-2 hours |
| 13.16.2 | App Icon Creation | 2-4 hours (depends on design skills) |
| 13.16.3 | Developer Portal Setup | 1-2 hours |
| 13.16.4 | App Store Metadata | 2-4 hours |
| 13.16.5 | Privacy & Legal | 2-3 hours |
| 13.16.6 | Production Environment | 1-2 hours |
| 13.16.7 | Archive & Device Testing | 2-4 hours |
| 13.16.8 | TestFlight Submission | 1-2 hours |
| 13.16.9 | Beta Testing Round | 1-2 weeks |
| 13.16.10 | App Store Submission | 1-2 hours |

---

## Reference Links

- [Apple Human Interface Guidelines - App Icons](https://developer.apple.com/design/human-interface-guidelines/app-icons)
- [App Store Connect Help](https://developer.apple.com/help/app-store-connect/)
- [TestFlight Documentation](https://developer.apple.com/testflight/)
- [App Store Review Guidelines](https://developer.apple.com/app-store/review/guidelines/)
- [Required App Metadata](https://developer.apple.com/help/app-store-connect/create-an-app-record/required-localizable-and-editable-properties)

---

## Changelog

| Date | Change |
|------|--------|
| 2024-12-26 | Initial Phase 13.16 specification created |
